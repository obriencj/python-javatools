
<!DOCTYPE html>

<html lang="English">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>javatools &#8212; python-javatools 1.6.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">python-javatools 1.6.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">javatools</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for javatools</h1><div class="highlight"><pre>
<span></span><span class="c1"># This library is free software; you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU Lesser General Public License as</span>
<span class="c1"># published by the Free Software Foundation; either version 3 of the</span>
<span class="c1"># License, or (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This library is distributed in the hope that it will be useful, but</span>
<span class="c1"># WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<span class="c1"># Lesser General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU Lesser General Public</span>
<span class="c1"># License along with this library; if not, see</span>
<span class="c1"># &lt;http://www.gnu.org/licenses/&gt;.</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Simple Java Classfile unpacking module. Can be made to act an</span>
<span class="sd">awful lot like the javap utility included with most Java SDKs.</span>

<span class="sd">Most of the information used to write this was gathered from the</span>
<span class="sd">following web pages</span>

<span class="sd">References</span>
<span class="sd">----------</span>
<span class="sd">* http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html</span>
<span class="sd">* http://java.sun.com/docs/books/jvms/second_edition/html/VMSpecTOC.doc.html</span>
<span class="sd">* http://en.wikipedia.org/wiki/Class_(file_format)</span>

<span class="sd">:author: Christopher O&#39;Brien  &lt;obriencj@gmail.com&gt;</span>
<span class="sd">:license: LGPL</span>
<span class="sd">&quot;&quot;&quot;</span>  <span class="c1"># noqa</span>


<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="nb">range</span>

<span class="kn">from</span> <span class="nn">.dirutils</span> <span class="kn">import</span> <span class="n">fnmatches</span>
<span class="kn">from</span> <span class="nn">.opcodes</span> <span class="kn">import</span> <span class="n">disassemble</span>
<span class="kn">from</span> <span class="nn">.pack</span> <span class="kn">import</span> <span class="n">compile_struct</span><span class="p">,</span> <span class="n">unpack</span><span class="p">,</span> <span class="n">UnpackException</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">buffer</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="nb">memoryview</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;JavaClassInfo&quot;</span><span class="p">,</span> <span class="s2">&quot;JavaConstantPool&quot;</span><span class="p">,</span> <span class="s2">&quot;JavaMemberInfo&quot;</span><span class="p">,</span>
    <span class="s2">&quot;JavaCodeInfo&quot;</span><span class="p">,</span> <span class="s2">&quot;JavaExceptionInfo&quot;</span><span class="p">,</span> <span class="s2">&quot;JavaInnerClassInfo&quot;</span><span class="p">,</span>
    <span class="s2">&quot;JavaAnnotation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NoPoolException&quot;</span><span class="p">,</span> <span class="s2">&quot;Unimplemented&quot;</span><span class="p">,</span> <span class="s2">&quot;ClassUnpackException&quot;</span><span class="p">,</span>
    <span class="s2">&quot;UnknownConstantPoolTagException&quot;</span><span class="p">,</span> <span class="s2">&quot;UnpackException&quot;</span><span class="p">,</span>
    <span class="s2">&quot;platform_from_version&quot;</span><span class="p">,</span>
    <span class="s2">&quot;is_class&quot;</span><span class="p">,</span> <span class="s2">&quot;is_class_file&quot;</span><span class="p">,</span>
    <span class="s2">&quot;unpack_class&quot;</span><span class="p">,</span> <span class="s2">&quot;unpack_classfile&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CONST_Utf8&quot;</span><span class="p">,</span> <span class="s2">&quot;CONST_Integer&quot;</span><span class="p">,</span> <span class="s2">&quot;CONST_Float&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CONST_Long&quot;</span><span class="p">,</span> <span class="s2">&quot;CONST_Double&quot;</span><span class="p">,</span> <span class="s2">&quot;CONST_Class&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CONST_String&quot;</span><span class="p">,</span> <span class="s2">&quot;CONST_Fieldref&quot;</span><span class="p">,</span> <span class="s2">&quot;CONST_Methodref&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CONST_InterfaceMethodref&quot;</span><span class="p">,</span> <span class="s2">&quot;CONST_NameAndType&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CONST_ModuleId&quot;</span><span class="p">,</span> <span class="s2">&quot;CONST_MethodHandle&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CONST_MethodType&quot;</span><span class="p">,</span> <span class="s2">&quot;CONST_InvokeDynamic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CONST_Module&quot;</span><span class="p">,</span> <span class="s2">&quot;CONST_Package&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ACC_PUBLIC&quot;</span><span class="p">,</span> <span class="s2">&quot;ACC_PRIVATE&quot;</span><span class="p">,</span> <span class="s2">&quot;ACC_PROTECTED&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ACC_STATIC&quot;</span><span class="p">,</span> <span class="s2">&quot;ACC_FINAL&quot;</span><span class="p">,</span> <span class="s2">&quot;ACC_SYNCHRONIZED&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ACC_SUPER&quot;</span><span class="p">,</span> <span class="s2">&quot;ACC_VOLATILE&quot;</span><span class="p">,</span> <span class="s2">&quot;ACC_BRIDGE&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ACC_TRANSIENT&quot;</span><span class="p">,</span> <span class="s2">&quot;ACC_VARARGS&quot;</span><span class="p">,</span> <span class="s2">&quot;ACC_NATIVE&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ACC_INTERFACE&quot;</span><span class="p">,</span> <span class="s2">&quot;ACC_ABSTRACT&quot;</span><span class="p">,</span> <span class="s2">&quot;ACC_STRICT&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ACC_SYNTHETIC&quot;</span><span class="p">,</span> <span class="s2">&quot;ACC_ANNOTATION&quot;</span><span class="p">,</span> <span class="s2">&quot;ACC_ENUM&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ACC_MODULE&quot;</span><span class="p">,</span>
<span class="p">)</span>


<span class="c1"># the four bytes at the start of every class file</span>
<span class="n">JAVA_CLASS_MAGIC</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0xCA</span><span class="p">,</span> <span class="mh">0xFE</span><span class="p">,</span> <span class="mh">0xBA</span><span class="p">,</span> <span class="mh">0xBE</span><span class="p">)</span>


<span class="n">_BUFFERING</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">14</span>


<span class="c1"># The constant pool types</span>
<span class="c1"># pylint: disable=C0103</span>
<span class="n">CONST_Utf8</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">CONST_Integer</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">CONST_Float</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">CONST_Long</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">CONST_Double</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">CONST_Class</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">CONST_String</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">CONST_Fieldref</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">CONST_Methodref</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">CONST_InterfaceMethodref</span> <span class="o">=</span> <span class="mi">11</span>
<span class="n">CONST_NameAndType</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">CONST_ModuleId</span> <span class="o">=</span> <span class="mi">13</span>  <span class="c1"># Removed? Maybe OpenJDK only?</span>
<span class="n">CONST_MethodHandle</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">CONST_MethodType</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">CONST_Dynamic</span> <span class="o">=</span> <span class="mi">17</span>
<span class="n">CONST_InvokeDynamic</span> <span class="o">=</span> <span class="mi">18</span>
<span class="n">CONST_Module</span> <span class="o">=</span> <span class="mi">19</span>
<span class="n">CONST_Package</span> <span class="o">=</span> <span class="mi">20</span>


<span class="c1"># class and member flags</span>
<span class="n">ACC_PUBLIC</span> <span class="o">=</span> <span class="mh">0x0001</span>
<span class="n">ACC_PRIVATE</span> <span class="o">=</span> <span class="mh">0x0002</span>
<span class="n">ACC_PROTECTED</span> <span class="o">=</span> <span class="mh">0x0004</span>
<span class="n">ACC_STATIC</span> <span class="o">=</span> <span class="mh">0x0008</span>
<span class="n">ACC_FINAL</span> <span class="o">=</span> <span class="mh">0x0010</span>
<span class="n">ACC_SYNCHRONIZED</span> <span class="o">=</span> <span class="mh">0x0020</span>
<span class="n">ACC_SUPER</span> <span class="o">=</span> <span class="mh">0x0020</span>
<span class="n">ACC_VOLATILE</span> <span class="o">=</span> <span class="mh">0x0040</span>
<span class="n">ACC_BRIDGE</span> <span class="o">=</span> <span class="mh">0x0040</span>
<span class="n">ACC_TRANSIENT</span> <span class="o">=</span> <span class="mh">0x0080</span>
<span class="n">ACC_VARARGS</span> <span class="o">=</span> <span class="mh">0x0080</span>
<span class="n">ACC_NATIVE</span> <span class="o">=</span> <span class="mh">0x0100</span>
<span class="n">ACC_INTERFACE</span> <span class="o">=</span> <span class="mh">0x0200</span>
<span class="n">ACC_ABSTRACT</span> <span class="o">=</span> <span class="mh">0x0400</span>
<span class="n">ACC_STRICT</span> <span class="o">=</span> <span class="mh">0x0800</span>
<span class="n">ACC_SYNTHETIC</span> <span class="o">=</span> <span class="mh">0x1000</span>
<span class="n">ACC_ANNOTATION</span> <span class="o">=</span> <span class="mh">0x2000</span>
<span class="n">ACC_ENUM</span> <span class="o">=</span> <span class="mh">0x4000</span>
<span class="n">ACC_MODULE</span> <span class="o">=</span> <span class="mh">0x8000</span>


<span class="c1"># commonly re-occurring struct formats</span>
<span class="n">_B</span> <span class="o">=</span> <span class="n">compile_struct</span><span class="p">(</span><span class="s2">&quot;&gt;B&quot;</span><span class="p">)</span>
<span class="n">_BBBB</span> <span class="o">=</span> <span class="n">compile_struct</span><span class="p">(</span><span class="s2">&quot;&gt;BBBB&quot;</span><span class="p">)</span>
<span class="n">_BH</span> <span class="o">=</span> <span class="n">compile_struct</span><span class="p">(</span><span class="s2">&quot;&gt;BH&quot;</span><span class="p">)</span>
<span class="n">_H</span> <span class="o">=</span> <span class="n">compile_struct</span><span class="p">(</span><span class="s2">&quot;&gt;H&quot;</span><span class="p">)</span>
<span class="n">_HH</span> <span class="o">=</span> <span class="n">compile_struct</span><span class="p">(</span><span class="s2">&quot;&gt;HH&quot;</span><span class="p">)</span>
<span class="n">_HHH</span> <span class="o">=</span> <span class="n">compile_struct</span><span class="p">(</span><span class="s2">&quot;&gt;HHH&quot;</span><span class="p">)</span>
<span class="n">_HHHH</span> <span class="o">=</span> <span class="n">compile_struct</span><span class="p">(</span><span class="s2">&quot;&gt;HHHH&quot;</span><span class="p">)</span>
<span class="n">_HHHHH</span> <span class="o">=</span> <span class="n">compile_struct</span><span class="p">(</span><span class="s2">&quot;&gt;HHHHH&quot;</span><span class="p">)</span>
<span class="n">_HI</span> <span class="o">=</span> <span class="n">compile_struct</span><span class="p">(</span><span class="s2">&quot;&gt;HI&quot;</span><span class="p">)</span>
<span class="n">_HHI</span> <span class="o">=</span> <span class="n">compile_struct</span><span class="p">(</span><span class="s2">&quot;&gt;HHI&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="NoPoolException"><a class="viewcode-back" href="../../javatools/#javatools.NoPoolException">[docs]</a><span class="k">class</span> <span class="nc">NoPoolException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    raised by methods that need a JavaConstantPool, but aren&#39;t</span>
<span class="sd">    provided one on the owning instance</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">pass</span></div>


<div class="viewcode-block" id="Unimplemented"><a class="viewcode-back" href="../../javatools/#javatools.Unimplemented">[docs]</a><span class="k">class</span> <span class="nc">Unimplemented</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    raised when something unexpected happens, which usually indicates</span>
<span class="sd">    part of the classfile specification that wasn&#39;t implemented in</span>
<span class="sd">    this module yet</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">pass</span></div>


<div class="viewcode-block" id="ClassUnpackException"><a class="viewcode-back" href="../../javatools/#javatools.ClassUnpackException">[docs]</a><span class="k">class</span> <span class="nc">ClassUnpackException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    raised when a class couldn&#39;t be unpacked</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">pass</span></div>


<div class="viewcode-block" id="UnknownConstantPoolTagException"><a class="viewcode-back" href="../../javatools/#javatools.UnknownConstantPoolTagException">[docs]</a><span class="k">class</span> <span class="nc">UnknownConstantPoolTagException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    raised when a constant pool tag is unknown and probably corrupted</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">pass</span></div>


<div class="viewcode-block" id="JavaConstantPool"><a class="viewcode-back" href="../../javatools/#javatools.JavaConstantPool">[docs]</a><span class="k">class</span> <span class="nc">JavaConstantPool</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A constants pool</span>

<span class="sd">    reference: http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.4</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consts</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>


    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">JavaConstantPool</span><span class="p">)</span> <span class="ow">and</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">consts</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">consts</span><span class="p">))</span>


    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>


<div class="viewcode-block" id="JavaConstantPool.unpack"><a class="viewcode-back" href="../../javatools/#javatools.JavaConstantPool.unpack">[docs]</a>    <span class="k">def</span> <span class="nf">unpack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unpacker</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unpacks the constant pool from an unpacker stream</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_H</span><span class="p">)</span>

        <span class="c1"># first item is never present in the actual data buffer, but</span>
        <span class="c1"># the count number acts like it would be.</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="p">]</span>
        <span class="n">count</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="c1"># Long and Double const types will &quot;consume&quot; an item count,</span>
        <span class="c1"># but not data</span>
        <span class="n">hackpass</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">hackpass</span><span class="p">:</span>
                <span class="c1"># previous item was a long or double</span>
                <span class="n">hackpass</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">_unpack_const_item</span><span class="p">(</span><span class="n">unpacker</span><span class="p">)</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

                <span class="c1"># if this item was a long or double, skip the next</span>
                <span class="c1"># counter.</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">CONST_Long</span><span class="p">,</span> <span class="n">CONST_Double</span><span class="p">):</span>
                    <span class="n">hackpass</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">consts</span> <span class="o">=</span> <span class="n">items</span></div>


<div class="viewcode-block" id="JavaConstantPool.get_const"><a class="viewcode-back" href="../../javatools/#javatools.JavaConstantPool.get_const">[docs]</a>    <span class="k">def</span> <span class="nf">get_const</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns the type and value of the constant at index</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">consts</span><span class="p">[</span><span class="n">index</span><span class="p">]</span></div>


<div class="viewcode-block" id="JavaConstantPool.deref_const"><a class="viewcode-back" href="../../javatools/#javatools.JavaConstantPool.deref_const">[docs]</a>    <span class="k">def</span> <span class="nf">deref_const</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns the dereferenced value from the const pool. For simple</span>
<span class="sd">        types, this will be a single value indicating the constant.</span>
<span class="sd">        For more complex types, such as fieldref, methodref, etc, this</span>
<span class="sd">        will return a tuple.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">index</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;Requested const 0&quot;</span><span class="p">)</span>

        <span class="n">t</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consts</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="c1"># CONSTANT_info {</span>
        <span class="c1">#     u1 tag;</span>
        <span class="c1">#     u4 bytes; (the value of the constant)</span>
        <span class="c1"># }</span>
        <span class="c1"># NOTE: Long and Double has high_bytes and low_bytes.</span>
        <span class="c1"># NOTE: Utf8 has two fields length and bytes</span>
        <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">(</span><span class="n">CONST_Utf8</span><span class="p">,</span> <span class="n">CONST_Integer</span><span class="p">,</span> <span class="n">CONST_Float</span><span class="p">,</span>
                 <span class="n">CONST_Long</span><span class="p">,</span> <span class="n">CONST_Double</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">v</span>

        <span class="c1"># CONSTANT_info {</span>
        <span class="c1">#     u1 tag;</span>
        <span class="c1">#     u2 index; (valid index into the constant_pool)</span>
        <span class="c1"># }</span>
        <span class="c1"># NOTE: each constant can have a little bit different field name</span>
        <span class="k">elif</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">(</span><span class="n">CONST_Class</span><span class="p">,</span> <span class="n">CONST_String</span><span class="p">,</span> <span class="n">CONST_MethodType</span><span class="p">,</span>
                   <span class="n">CONST_Module</span><span class="p">,</span> <span class="n">CONST_Package</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

        <span class="c1"># CONSTANT_info {</span>
        <span class="c1">#     u1 tag;</span>
        <span class="c1">#     u2 index; (valid index into the constant_pool)</span>
        <span class="c1">#     u2 additional_index; (valid index into the constant_pool)</span>
        <span class="c1"># }</span>
        <span class="c1"># NOTE: each constant can have a little bit different field name</span>
        <span class="k">elif</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">(</span><span class="n">CONST_Fieldref</span><span class="p">,</span> <span class="n">CONST_Methodref</span><span class="p">,</span>
                   <span class="n">CONST_InterfaceMethodref</span><span class="p">,</span> <span class="n">CONST_NameAndType</span><span class="p">,</span>
                   <span class="n">CONST_ModuleId</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">v</span><span class="p">)</span>

        <span class="c1"># CONSTANT_info {</span>
        <span class="c1">#     u1 tag;</span>
        <span class="c1">#     u2 bootstrap_method_attr_index; (must be a valid index into the</span>
        <span class="c1">#                                      bootstrap_methods array</span>
        <span class="c1">#                                      of the bootstrap method table of</span>
        <span class="c1">#                                      this class file)</span>
        <span class="c1">#     u2 name_and_type_index; (valid index into the constant_pool)</span>
        <span class="c1"># }</span>
        <span class="k">elif</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">(</span><span class="n">CONST_InvokeDynamic</span><span class="p">,</span> <span class="n">CONST_Dynamic</span><span class="p">):</span>
            <span class="c1"># TODO: v[0] needs to come from the bootstrap methods table</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="c1"># CONSTANT_info {</span>
        <span class="c1">#     u1 tag;</span>
        <span class="c1">#     u1 reference_kind; (must be in the range 1 to 9)</span>
        <span class="c1">#     u2 reference_index; (valid index into the constant_pool)</span>
        <span class="c1"># }</span>
        <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="n">CONST_MethodHandle</span><span class="p">:</span>
            <span class="c1"># TODO: v[0] treat index according to its kind</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UnknownConstantPoolTagException</span><span class="p">(</span>
                <span class="s2">&quot;Unknown constant pool type </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">t</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaConstantPool.constants"><a class="viewcode-back" href="../../javatools/#javatools.JavaConstantPool.constants">[docs]</a>    <span class="k">def</span> <span class="nf">constants</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        sequence of tuples (index, type, dereferenced value) of the</span>
<span class="sd">        constant pool entries.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">consts</span><span class="p">)):</span>
            <span class="n">t</span><span class="p">,</span> <span class="n">_v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">t</span><span class="p">:</span>
                <span class="k">yield</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">i</span><span class="p">))</span></div>


<div class="viewcode-block" id="JavaConstantPool.pretty_constants"><a class="viewcode-back" href="../../javatools/#javatools.JavaConstantPool.pretty_constants">[docs]</a>    <span class="k">def</span> <span class="nf">pretty_constants</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the sequence of tuples (index, pretty type, value) of the constant</span>
<span class="sd">        pool entries.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">consts</span><span class="p">)):</span>
            <span class="n">t</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pretty_const</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">t</span><span class="p">:</span>
                <span class="k">yield</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaConstantPool.pretty_const"><a class="viewcode-back" href="../../javatools/#javatools.JavaConstantPool.pretty_const">[docs]</a>    <span class="k">def</span> <span class="nf">pretty_const</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a tuple of the pretty type and val, or (None, None) for invalid</span>
<span class="sd">        indexes (such as the second part of a long or double value)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">t</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consts</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">t</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_pretty_const_type_val</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaConstantPool.pretty_deref_const"><a class="viewcode-back" href="../../javatools/#javatools.JavaConstantPool.pretty_deref_const">[docs]</a>    <span class="k">def</span> <span class="nf">pretty_deref_const</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A string representation of the end-value of a constant.  This will</span>
<span class="sd">        deref the constant index, and if it is a compound type, will</span>
<span class="sd">        continue dereferencing until it can compose the full value</span>
<span class="sd">        (eg: a CONST_Methodref will be composed of its class, name,</span>
<span class="sd">        and value derefenced constants)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">t</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consts</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="n">CONST_String</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">(</span><span class="n">CONST_Utf8</span><span class="p">,</span>
                   <span class="n">CONST_Integer</span><span class="p">,</span> <span class="n">CONST_Float</span><span class="p">,</span>
                   <span class="n">CONST_Long</span><span class="p">,</span> <span class="n">CONST_Double</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">v</span>

        <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="n">CONST_Class</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">_pretty_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="n">CONST_Fieldref</span><span class="p">:</span>
            <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">cn</span> <span class="o">=</span> <span class="n">_pretty_class</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span>

            <span class="n">n</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cn</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">_pretty_type</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">(</span><span class="n">CONST_Methodref</span><span class="p">,</span>
                   <span class="n">CONST_InterfaceMethodref</span><span class="p">):</span>

            <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">cn</span> <span class="o">=</span> <span class="n">_pretty_class</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span>

            <span class="n">n</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">args</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">_pretty_typeseq</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>

            <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cn</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">ret</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="n">CONST_NameAndType</span><span class="p">:</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">v</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_pretty_typeseq</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="n">CONST_ModuleId</span><span class="p">:</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">v</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">@</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="n">CONST_InvokeDynamic</span><span class="p">:</span>
            <span class="c1"># TODO: v[0] needs to come from the bootstrap methods table</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;InvokeDynamic </span><span class="si">%r</span><span class="s2"> </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="n">CONST_Dynamic</span><span class="p">:</span>
            <span class="c1"># TODO: v[0] needs to come from the bootstrap methods table</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;Dynamic </span><span class="si">%r</span><span class="s2"> </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="n">CONST_MethodType</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;MethodType </span><span class="si">%r</span><span class="s2"> </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="n">CONST_Module</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;Module </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">deref_cons</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="n">CONST_Package</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;Package </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">deref_cons</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="n">t</span><span class="p">:</span>
            <span class="c1"># the skipped-type, meaning the prior index was a</span>
            <span class="c1"># two-slotter.</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UnknownConstantPoolTagException</span><span class="p">(</span>
                <span class="s2">&quot;No pretty for const type </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">t</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span></div></div>


<span class="k">class</span> <span class="nc">JavaAttributes</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    attributes table, as used in class, member, and code</span>
<span class="sd">    structures. Requires access to a JavaConstantPool instance for</span>
<span class="sd">    many of its methods to work correctly.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cpool</span><span class="p">):</span>
        <span class="nb">dict</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpool</span> <span class="o">=</span> <span class="n">cpool</span>


    <span class="k">def</span> <span class="nf">unpack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unpacker</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unpack an attributes table from an unpacker stream.  Modifies the</span>
<span class="sd">        structure of this instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># bound method for dereferencing constants</span>
        <span class="n">cval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpool</span><span class="o">.</span><span class="n">deref_const</span>

        <span class="p">(</span><span class="n">count</span><span class="p">,)</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_H</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
            <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_HI</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">cval</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>


<div class="viewcode-block" id="JavaClassInfo"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo">[docs]</a><span class="k">class</span> <span class="nc">JavaClassInfo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Information from a disassembled Java class file.</span>

<span class="sd">    reference: http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpool</span> <span class="o">=</span> <span class="n">JavaConstantPool</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attribs</span> <span class="o">=</span> <span class="n">JavaAttributes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpool</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">magic</span> <span class="o">=</span> <span class="n">JAVA_CLASS_MAGIC</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">this_ref</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">super_ref</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interfaces</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">methods</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotations</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">invisible_annotations</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_provides</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_provides_private</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_requires</span> <span class="o">=</span> <span class="kc">None</span>


<div class="viewcode-block" id="JavaClassInfo.deref_const"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.deref_const">[docs]</a>    <span class="k">def</span> <span class="nf">deref_const</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        dereference a value from the parent constant pool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpool</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaClassInfo.get_attribute"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.get_attribute">[docs]</a>    <span class="k">def</span> <span class="nf">get_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get an attribute buffer by name</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attribs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaClassInfo.unpack"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.unpack">[docs]</a>    <span class="k">def</span> <span class="nf">unpack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unpacker</span><span class="p">,</span> <span class="n">magic</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unpacks a Java class from an unpacker stream. Updates the</span>
<span class="sd">        structure of this instance.</span>

<span class="sd">        If the unpacker has already had the magic header read off of</span>
<span class="sd">        it, the read value may be passed via the optional magic</span>
<span class="sd">        parameter and it will not attempt to read the value again.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># only unpack the magic bytes if it wasn&#39;t specified</span>
        <span class="n">magic</span> <span class="o">=</span> <span class="n">magic</span> <span class="ow">or</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_BBBB</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">magic</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">buffer</span><span class="p">)):</span>
            <span class="n">magic</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">magic</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">magic</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">magic</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">magic</span> <span class="o">!=</span> <span class="n">JAVA_CLASS_MAGIC</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ClassUnpackException</span><span class="p">(</span><span class="s2">&quot;Not a Java class file&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">magic</span> <span class="o">=</span> <span class="n">magic</span>

        <span class="c1"># unpack (minor, major), store as (major, minor)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_HH</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># unpack constant pool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpool</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">unpacker</span><span class="p">)</span>

        <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_HHH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">=</span> <span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">this_ref</span> <span class="o">=</span> <span class="n">b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">super_ref</span> <span class="o">=</span> <span class="n">c</span>

        <span class="c1"># unpack interfaces</span>
        <span class="p">(</span><span class="n">count</span><span class="p">,)</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_H</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interfaces</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;</span><span class="si">%i</span><span class="s2">H&quot;</span> <span class="o">%</span> <span class="n">count</span><span class="p">)</span>

        <span class="n">uobjs</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack_objects</span>

        <span class="c1"># unpack fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">uobjs</span><span class="p">(</span><span class="n">JavaMemberInfo</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">cpool</span><span class="p">,</span> <span class="n">is_method</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

        <span class="c1"># unpack methods</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">methods</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">uobjs</span><span class="p">(</span><span class="n">JavaMemberInfo</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">cpool</span><span class="p">,</span> <span class="n">is_method</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

        <span class="c1"># unpack attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attribs</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">unpacker</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaClassInfo.get_field_by_name"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.get_field_by_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_field_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the field member matching name, or None if no such field is found</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">f</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="JavaClassInfo.get_methods_by_name"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.get_methods_by_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_methods_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        generator of methods matching name. This will include any bridges</span>
<span class="sd">        present.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">methods</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">==</span> <span class="n">name</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaClassInfo.get_method"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.get_method">[docs]</a>    <span class="k">def</span> <span class="nf">get_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">arg_types</span><span class="o">=</span><span class="p">()):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        searches for the method matching the name and having argument type</span>
<span class="sd">        descriptors matching those in arg_types.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">        arg_types : sequence of strings</span>
<span class="sd">          each string is a parameter type, in the non-pretty format.</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>
<span class="sd">        method : `JavaMemberInfo` or `None`</span>
<span class="sd">          the single matching, non-bridging method of matching name</span>
<span class="sd">          and parameter types.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># ensure any lists or iterables are converted to tuple for</span>
        <span class="c1"># comparison against get_arg_type_descriptors()</span>
        <span class="n">arg_types</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">arg_types</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_methods_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(((</span><span class="ow">not</span> <span class="n">m</span><span class="o">.</span><span class="n">is_bridge</span><span class="p">())</span> <span class="ow">and</span>
                 <span class="n">m</span><span class="o">.</span><span class="n">get_arg_type_descriptors</span><span class="p">()</span> <span class="o">==</span> <span class="n">arg_types</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">m</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="JavaClassInfo.get_method_bridges"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.get_method_bridges">[docs]</a>    <span class="k">def</span> <span class="nf">get_method_bridges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">arg_types</span><span class="o">=</span><span class="p">()):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        generator of bridge methods found that adapt the return types of a</span>
<span class="sd">        named method and having argument type descriptors matching</span>
<span class="sd">        those in arg_types.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_methods_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">m</span><span class="o">.</span><span class="n">is_bridge</span><span class="p">()</span> <span class="ow">and</span>
                 <span class="n">m</span><span class="o">.</span><span class="n">get_arg_type_descriptors</span><span class="p">()</span> <span class="o">==</span> <span class="n">arg_types</span><span class="p">)):</span>
                <span class="k">yield</span> <span class="n">m</span></div>


<div class="viewcode-block" id="JavaClassInfo.get_version"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.get_version">[docs]</a>    <span class="k">def</span> <span class="nf">get_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the (major, minor) version of Java required by this Java class</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span></div>


<div class="viewcode-block" id="JavaClassInfo.get_platform"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.get_platform">[docs]</a>    <span class="k">def</span> <span class="nf">get_platform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The platform as a string, derived from the major and minor version</span>
<span class="sd">        number</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">platform_from_version</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaClassInfo.is_public"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.is_public">[docs]</a>    <span class="k">def</span> <span class="nf">is_public</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        is this class public</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">&amp;</span> <span class="n">ACC_PUBLIC</span></div>


<div class="viewcode-block" id="JavaClassInfo.is_final"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.is_final">[docs]</a>    <span class="k">def</span> <span class="nf">is_final</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        is this class final</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">&amp;</span> <span class="n">ACC_FINAL</span></div>


<div class="viewcode-block" id="JavaClassInfo.is_super"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.is_super">[docs]</a>    <span class="k">def</span> <span class="nf">is_super</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        class has the Super flag set.</span>

<span class="sd">        This flag is used by the JVM to differentiate the behavior in</span>
<span class="sd">        the method resolution order of the class.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">&amp;</span> <span class="n">ACC_SUPER</span></div>


<div class="viewcode-block" id="JavaClassInfo.is_interface"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.is_interface">[docs]</a>    <span class="k">def</span> <span class="nf">is_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        is this an interface</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">&amp;</span> <span class="n">ACC_INTERFACE</span></div>


<div class="viewcode-block" id="JavaClassInfo.is_abstract"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.is_abstract">[docs]</a>    <span class="k">def</span> <span class="nf">is_abstract</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        is this an abstract class</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">&amp;</span> <span class="n">ACC_ABSTRACT</span></div>


<div class="viewcode-block" id="JavaClassInfo.is_annotation"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.is_annotation">[docs]</a>    <span class="k">def</span> <span class="nf">is_annotation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        is this an annotation class</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">&amp;</span> <span class="n">ACC_ANNOTATION</span></div>


<div class="viewcode-block" id="JavaClassInfo.is_enum"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.is_enum">[docs]</a>    <span class="k">def</span> <span class="nf">is_enum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        is this an enum class</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">&amp;</span> <span class="n">ACC_ENUM</span></div>


<div class="viewcode-block" id="JavaClassInfo.get_this"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.get_this">[docs]</a>    <span class="k">def</span> <span class="nf">get_this</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the name of this class</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">this_ref</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaClassInfo.is_deprecated"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.is_deprecated">[docs]</a>    <span class="k">def</span> <span class="nf">is_deprecated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        is this class deprecated</span>

<span class="sd">        reference: http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.7.15</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;Deprecated&quot;</span><span class="p">))</span></div>


<div class="viewcode-block" id="JavaClassInfo.get_super"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.get_super">[docs]</a>    <span class="k">def</span> <span class="nf">get_super</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the parent class that this extends</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">super_ref</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">super_ref</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span></div>


<div class="viewcode-block" id="JavaClassInfo.get_interfaces"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.get_interfaces">[docs]</a>    <span class="k">def</span> <span class="nf">get_interfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        tuple of interfaces that this class implements</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interfaces</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_get_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">python_attr_name</span><span class="p">,</span> <span class="n">java_attr_name</span><span class="p">):</span>

        <span class="n">annos</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">python_attr_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">annos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">buff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="n">java_attr_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">buff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">annos</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">unpack</span><span class="p">(</span><span class="n">buff</span><span class="p">)</span> <span class="k">as</span> <span class="n">up</span><span class="p">:</span>
                    <span class="n">annos</span> <span class="o">=</span> <span class="n">up</span><span class="o">.</span><span class="n">unpack_objects</span><span class="p">(</span><span class="n">JavaAnnotation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpool</span><span class="p">)</span>
                    <span class="n">annos</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">annos</span><span class="p">)</span>

            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">python_attr_name</span><span class="p">,</span> <span class="n">annos</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">annos</span>


<div class="viewcode-block" id="JavaClassInfo.get_annotations"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.get_annotations">[docs]</a>    <span class="k">def</span> <span class="nf">get_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The RuntimeVisibleAnnotations attribute. A tuple of JavaAnnotation</span>
<span class="sd">        instances</span>

<span class="sd">        reference: http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.7.16</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_annotations</span><span class="p">(</span><span class="s2">&quot;annotations&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;RuntimeVisibleAnnotations&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaClassInfo.get_invisible_annotations"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.get_invisible_annotations">[docs]</a>    <span class="k">def</span> <span class="nf">get_invisible_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The RuntimeInvisibleAnnotations attribute. A tuple of</span>
<span class="sd">        JavaAnnotation instances</span>

<span class="sd">        reference: http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.7.17</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_annotations</span><span class="p">(</span><span class="s2">&quot;invisible_annotations&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;RuntimeInvisibleAnnotations&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaClassInfo.get_sourcefile"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.get_sourcefile">[docs]</a>    <span class="k">def</span> <span class="nf">get_sourcefile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the name of thie file this class was compiled from, or None if not</span>
<span class="sd">        indicated</span>

<span class="sd">        reference: http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.7.10</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

        <span class="n">buff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;SourceFile&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">buff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">with</span> <span class="n">unpack</span><span class="p">(</span><span class="n">buff</span><span class="p">)</span> <span class="k">as</span> <span class="n">up</span><span class="p">:</span>
            <span class="p">(</span><span class="n">ref</span><span class="p">,)</span> <span class="o">=</span> <span class="n">up</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_H</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaClassInfo.get_source_debug_extension"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.get_source_debug_extension">[docs]</a>    <span class="k">def</span> <span class="nf">get_source_debug_extension</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reference:</span>
<span class="sd">        http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.7.11</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

        <span class="n">buff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;SourceDebugExtension&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">buff</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">buff</span><span class="p">))</span> <span class="ow">or</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="JavaClassInfo.get_innerclasses"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.get_innerclasses">[docs]</a>    <span class="k">def</span> <span class="nf">get_innerclasses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        sequence of JavaInnerClassInfo instances describing the inner</span>
<span class="sd">        classes of this class definition</span>

<span class="sd">        reference: http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.7.6</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

        <span class="n">buff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;InnerClasses&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">buff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">()</span>

        <span class="k">with</span> <span class="n">unpack</span><span class="p">(</span><span class="n">buff</span><span class="p">)</span> <span class="k">as</span> <span class="n">up</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">up</span><span class="o">.</span><span class="n">unpack_objects</span><span class="p">(</span><span class="n">JavaInnerClassInfo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpool</span><span class="p">))</span></div>


<div class="viewcode-block" id="JavaClassInfo.get_signature"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.get_signature">[docs]</a>    <span class="k">def</span> <span class="nf">get_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the generics class signature</span>

<span class="sd">        reference: http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.7.9</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

        <span class="n">buff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;Signature&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">buff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">with</span> <span class="n">unpack</span><span class="p">(</span><span class="n">buff</span><span class="p">)</span> <span class="k">as</span> <span class="n">up</span><span class="p">:</span>
            <span class="p">(</span><span class="n">ref</span><span class="p">,)</span> <span class="o">=</span> <span class="n">up</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_H</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaClassInfo.pretty_signature"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.pretty_signature">[docs]</a>    <span class="k">def</span> <span class="nf">pretty_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        pretty version of the signature</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">pretty_generic</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_signature</span><span class="p">())</span></div>


<div class="viewcode-block" id="JavaClassInfo.get_enclosingmethod"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.get_enclosingmethod">[docs]</a>    <span class="k">def</span> <span class="nf">get_enclosingmethod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the class.method or class (if the definition is not from within a</span>
<span class="sd">        method) that encloses the definition of this class. Returns</span>
<span class="sd">        None if this was not an inner class.</span>

<span class="sd">        reference: http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.7.7</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

        <span class="n">buff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;EnclosingMethod&quot;</span><span class="p">)</span>

        <span class="c1"># TODO:</span>
        <span class="c1"># Running across classes with data in this attribute like</span>
        <span class="c1"># 00 06 00 00</span>
        <span class="c1"># which would be the 6th const for the class name, and the</span>
        <span class="c1"># zero-th (INVALID) const for method. Maybe this is static</span>
        <span class="c1"># inner classes?</span>

        <span class="k">if</span> <span class="n">buff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># class index, method index</span>
        <span class="k">with</span> <span class="n">unpack</span><span class="p">(</span><span class="n">buff</span><span class="p">)</span> <span class="k">as</span> <span class="n">up</span><span class="p">:</span>
            <span class="n">ci</span><span class="p">,</span> <span class="n">mi</span> <span class="o">=</span> <span class="n">up</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_HH</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">ci</span> <span class="ow">and</span> <span class="n">mi</span><span class="p">:</span>
            <span class="n">enc_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">ci</span><span class="p">)</span>
            <span class="n">enc_meth</span><span class="p">,</span> <span class="n">enc_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">mi</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">enc_class</span><span class="p">,</span> <span class="n">enc_meth</span><span class="p">,</span> <span class="n">enc_type</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">ci</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">ci</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span></div>


    <span class="k">def</span> <span class="nf">_pretty_access_flags_gen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        generator of the pretty access flags</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_public</span><span class="p">():</span>
            <span class="k">yield</span> <span class="s2">&quot;public&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_final</span><span class="p">():</span>
            <span class="k">yield</span> <span class="s2">&quot;final&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_abstract</span><span class="p">():</span>
            <span class="k">yield</span> <span class="s2">&quot;abstract&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_interface</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_annotation</span><span class="p">():</span>
                <span class="k">yield</span> <span class="s2">&quot;@interface&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">yield</span> <span class="s2">&quot;interface&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_enum</span><span class="p">():</span>
            <span class="k">yield</span> <span class="s2">&quot;enum&quot;</span>


<div class="viewcode-block" id="JavaClassInfo.pretty_access_flags"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.pretty_access_flags">[docs]</a>    <span class="k">def</span> <span class="nf">pretty_access_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        generator of the pretty access flag names</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pretty_access_flags_gen</span><span class="p">()</span></div>


<div class="viewcode-block" id="JavaClassInfo.pretty_this"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.pretty_this">[docs]</a>    <span class="k">def</span> <span class="nf">pretty_this</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the pretty version of this class name</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">_pretty_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_this</span><span class="p">())</span></div>


<div class="viewcode-block" id="JavaClassInfo.pretty_super"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.pretty_super">[docs]</a>    <span class="k">def</span> <span class="nf">pretty_super</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the pretty version of the parent class name</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">_pretty_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_super</span><span class="p">())</span></div>


<div class="viewcode-block" id="JavaClassInfo.pretty_interfaces"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.pretty_interfaces">[docs]</a>    <span class="k">def</span> <span class="nf">pretty_interfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the pretty versions of any interfaces this class implements</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">_pretty_class</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interfaces</span><span class="p">())</span></div>


<div class="viewcode-block" id="JavaClassInfo.pretty_descriptor"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.pretty_descriptor">[docs]</a>    <span class="k">def</span> <span class="nf">pretty_descriptor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the class or interface name, its accessor flags, its parent</span>
<span class="sd">        class, and any interfaces it implements</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">f</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pretty_access_flags</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_interface</span><span class="p">():</span>
            <span class="n">f</span> <span class="o">+=</span> <span class="s2">&quot; class&quot;</span>

        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pretty_this</span><span class="p">()</span>
        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pretty_super</span><span class="p">()</span>
        <span class="n">i</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pretty_interfaces</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">i</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> extends </span><span class="si">%s</span><span class="s2"> implements </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> extends </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_get_provides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">private</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        iterator of provided classes, fields, methods</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># TODO I probably need to add inner classes here</span>

        <span class="n">me</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pretty_this</span><span class="p">()</span>
        <span class="k">yield</span> <span class="n">me</span>

        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">private</span> <span class="ow">or</span> <span class="n">field</span><span class="o">.</span><span class="n">is_public</span><span class="p">():</span>
                <span class="k">yield</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">pretty_identifier</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">methods</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">private</span> <span class="ow">or</span> <span class="n">method</span><span class="o">.</span><span class="n">is_public</span><span class="p">():</span>
                <span class="k">yield</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="n">method</span><span class="o">.</span><span class="n">pretty_identifier</span><span class="p">())</span>


    <span class="k">def</span> <span class="nf">_get_requires</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        iterator of required classes, fields, methods, determined my</span>
<span class="sd">        mining the constant pool for such types</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">provided</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_provides</span><span class="p">(</span><span class="n">private</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">cpool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpool</span>

        <span class="c1"># loop through the constant pool for API types</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">_v</span> <span class="ow">in</span> <span class="n">cpool</span><span class="o">.</span><span class="n">constants</span><span class="p">():</span>

            <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">(</span><span class="n">CONST_Class</span><span class="p">,</span> <span class="n">CONST_Fieldref</span><span class="p">,</span>
                     <span class="n">CONST_Methodref</span><span class="p">,</span> <span class="n">CONST_InterfaceMethodref</span><span class="p">):</span>

                <span class="c1"># convert this away from unicode so we can</span>
                <span class="n">pv</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cpool</span><span class="o">.</span><span class="n">pretty_deref_const</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">pv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;[&quot;</span><span class="p">:</span>
                    <span class="c1"># sometimes when calling operations on an array</span>
                    <span class="c1"># the type embeded in the cpool will be the array</span>
                    <span class="c1"># type, not just the class type. Let&#39;s only gather</span>
                    <span class="c1"># the types themselves and ignore the fact that</span>
                    <span class="c1"># the class really wanted an array of them.  In</span>
                    <span class="c1"># the event that this was a method or field on the</span>
                    <span class="c1"># array, we&#39;ll throw away that as well, and just</span>
                    <span class="c1"># emit the type contained in the array.</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">_typeseq</span><span class="p">(</span><span class="n">pv</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;L&quot;</span><span class="p">:</span>
                        <span class="n">pv</span> <span class="o">=</span> <span class="n">_pretty_type</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">pv</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="n">pv</span> <span class="ow">and</span> <span class="p">(</span><span class="n">pv</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">provided</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">pv</span>


<div class="viewcode-block" id="JavaClassInfo.get_provides"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.get_provides">[docs]</a>    <span class="k">def</span> <span class="nf">get_provides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignored</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(),</span> <span class="n">private</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The provided API, including the class itself, its fields, and its</span>
<span class="sd">        methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">private</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_provides_private</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_provides_private</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_provides</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
            <span class="n">provides</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_provides_private</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_provides</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_provides</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_provides</span><span class="p">(</span><span class="kc">False</span><span class="p">))</span>
            <span class="n">provides</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_provides</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">prov</span> <span class="k">for</span> <span class="n">prov</span> <span class="ow">in</span> <span class="n">provides</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">fnmatches</span><span class="p">(</span><span class="n">prov</span><span class="p">,</span> <span class="o">*</span><span class="n">ignored</span><span class="p">)]</span></div>


<div class="viewcode-block" id="JavaClassInfo.get_requires"><a class="viewcode-back" href="../../javatools/#javatools.JavaClassInfo.get_requires">[docs]</a>    <span class="k">def</span> <span class="nf">get_requires</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignored</span><span class="o">=</span><span class="nb">tuple</span><span class="p">()):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The required API, including all external classes, fields, and</span>
<span class="sd">        methods that this class references</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_requires</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_requires</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_requires</span><span class="p">())</span>

        <span class="n">requires</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_requires</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">req</span> <span class="k">for</span> <span class="n">req</span> <span class="ow">in</span> <span class="n">requires</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">fnmatches</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="o">*</span><span class="n">ignored</span><span class="p">)]</span></div></div>


<div class="viewcode-block" id="JavaMemberInfo"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo">[docs]</a><span class="k">class</span> <span class="nc">JavaMemberInfo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A field or method of a java class</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cpool</span><span class="p">,</span> <span class="n">is_method</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpool</span> <span class="o">=</span> <span class="n">cpool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attribs</span> <span class="o">=</span> <span class="n">JavaAttributes</span><span class="p">(</span><span class="n">cpool</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_ref</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptor_ref</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_method</span> <span class="o">=</span> <span class="n">is_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotations</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">invisible_annotations</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_annotations</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">invisible_parameter_annotations</span> <span class="o">=</span> <span class="kc">None</span>


<div class="viewcode-block" id="JavaMemberInfo.deref_const"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.deref_const">[docs]</a>    <span class="k">def</span> <span class="nf">deref_const</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dereference a constant in the parent constant pool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpool</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaMemberInfo.get_attribute"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.get_attribute">[docs]</a>    <span class="k">def</span> <span class="nf">get_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an attribute buffer by name</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attribs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaMemberInfo.get_signature"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.get_signature">[docs]</a>    <span class="k">def</span> <span class="nf">get_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the Signature attribute</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">buff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;Signature&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">buff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># type index</span>
        <span class="k">with</span> <span class="n">unpack</span><span class="p">(</span><span class="n">buff</span><span class="p">)</span> <span class="k">as</span> <span class="n">up</span><span class="p">:</span>
            <span class="p">(</span><span class="n">ti</span><span class="p">,)</span> <span class="o">=</span> <span class="n">up</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_H</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">ti</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaMemberInfo.pretty_signature"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.pretty_signature">[docs]</a>    <span class="k">def</span> <span class="nf">pretty_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        pretty version of the signature</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">pretty_generic</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_signature</span><span class="p">())</span></div>


<div class="viewcode-block" id="JavaMemberInfo.get_module"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.get_module">[docs]</a>    <span class="k">def</span> <span class="nf">get_module</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the Module attribute</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">buff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;Module&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">buff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">with</span> <span class="n">unpack</span><span class="p">(</span><span class="n">buff</span><span class="p">)</span> <span class="k">as</span> <span class="n">up</span><span class="p">:</span>
            <span class="p">(</span><span class="n">ti</span><span class="p">,)</span> <span class="o">=</span> <span class="n">up</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_H</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">ti</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaMemberInfo.unpack"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.unpack">[docs]</a>    <span class="k">def</span> <span class="nf">unpack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unpacker</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        unpack the contents of this instance from the values in unpacker</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_HHH</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">=</span> <span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_ref</span> <span class="o">=</span> <span class="n">b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptor_ref</span> <span class="o">=</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attribs</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">unpacker</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaMemberInfo.get_name"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.get_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the name of this member</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name_ref</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaMemberInfo.get_descriptor"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.get_descriptor">[docs]</a>    <span class="k">def</span> <span class="nf">get_descriptor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the descriptor of this member</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">descriptor_ref</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaMemberInfo.is_public"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.is_public">[docs]</a>    <span class="k">def</span> <span class="nf">is_public</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        is this member public</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">&amp;</span> <span class="n">ACC_PUBLIC</span></div>


<div class="viewcode-block" id="JavaMemberInfo.is_private"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.is_private">[docs]</a>    <span class="k">def</span> <span class="nf">is_private</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        is this member private</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">&amp;</span> <span class="n">ACC_PRIVATE</span></div>


<div class="viewcode-block" id="JavaMemberInfo.is_protected"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.is_protected">[docs]</a>    <span class="k">def</span> <span class="nf">is_protected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        is this member protected</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">&amp;</span> <span class="n">ACC_PROTECTED</span></div>


<div class="viewcode-block" id="JavaMemberInfo.is_static"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.is_static">[docs]</a>    <span class="k">def</span> <span class="nf">is_static</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        is this member static</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">&amp;</span> <span class="n">ACC_STATIC</span></div>


<div class="viewcode-block" id="JavaMemberInfo.is_final"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.is_final">[docs]</a>    <span class="k">def</span> <span class="nf">is_final</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        is this member final</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">&amp;</span> <span class="n">ACC_FINAL</span></div>


<div class="viewcode-block" id="JavaMemberInfo.is_synchronized"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.is_synchronized">[docs]</a>    <span class="k">def</span> <span class="nf">is_synchronized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        is this member synchronized</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">&amp;</span> <span class="n">ACC_SYNCHRONIZED</span></div>


<div class="viewcode-block" id="JavaMemberInfo.is_native"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.is_native">[docs]</a>    <span class="k">def</span> <span class="nf">is_native</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        is this member native</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">&amp;</span> <span class="n">ACC_NATIVE</span></div>


<div class="viewcode-block" id="JavaMemberInfo.is_abstract"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.is_abstract">[docs]</a>    <span class="k">def</span> <span class="nf">is_abstract</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        is this member abstract</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">&amp;</span> <span class="n">ACC_ABSTRACT</span></div>


<div class="viewcode-block" id="JavaMemberInfo.is_strict"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.is_strict">[docs]</a>    <span class="k">def</span> <span class="nf">is_strict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        is this member strict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">&amp;</span> <span class="n">ACC_STRICT</span></div>


<div class="viewcode-block" id="JavaMemberInfo.is_volatile"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.is_volatile">[docs]</a>    <span class="k">def</span> <span class="nf">is_volatile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        is this member volatile</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">&amp;</span> <span class="n">ACC_VOLATILE</span></div>


<div class="viewcode-block" id="JavaMemberInfo.is_transient"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.is_transient">[docs]</a>    <span class="k">def</span> <span class="nf">is_transient</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        is this member transient</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">&amp;</span> <span class="n">ACC_TRANSIENT</span></div>


<div class="viewcode-block" id="JavaMemberInfo.is_bridge"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.is_bridge">[docs]</a>    <span class="k">def</span> <span class="nf">is_bridge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        is this method a bridge to another method</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">&amp;</span> <span class="n">ACC_BRIDGE</span></div>


<div class="viewcode-block" id="JavaMemberInfo.is_varargs"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.is_varargs">[docs]</a>    <span class="k">def</span> <span class="nf">is_varargs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        is this a varargs method</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">&amp;</span> <span class="n">ACC_VARARGS</span></div>


<div class="viewcode-block" id="JavaMemberInfo.is_synthetic"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.is_synthetic">[docs]</a>    <span class="k">def</span> <span class="nf">is_synthetic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        is this a synthetic method</span>

<span class="sd">        reference: http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.7.8</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">&amp;</span> <span class="n">ACC_SYNTHETIC</span><span class="p">)</span> <span class="ow">or</span>
                <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;Synthetic&quot;</span><span class="p">)))</span></div>


<div class="viewcode-block" id="JavaMemberInfo.is_enum"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.is_enum">[docs]</a>    <span class="k">def</span> <span class="nf">is_enum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        it this member an enum</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">&amp;</span> <span class="n">ACC_ENUM</span></div>


<div class="viewcode-block" id="JavaMemberInfo.is_module"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.is_module">[docs]</a>    <span class="k">def</span> <span class="nf">is_module</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        is this a module member</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">&amp;</span> <span class="n">ACC_MODULE</span></div>


<div class="viewcode-block" id="JavaMemberInfo.is_deprecated"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.is_deprecated">[docs]</a>    <span class="k">def</span> <span class="nf">is_deprecated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        is this member deprecated</span>

<span class="sd">        reference: http://docs.oracle.com/javase/specs/jvms/se5.0/html/ClassFile.doc.html#78232</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;Deprecated&quot;</span><span class="p">))</span></div>


    <span class="k">def</span> <span class="nf">_get_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">python_attr_name</span><span class="p">,</span> <span class="n">java_attr_name</span><span class="p">,</span>
                         <span class="n">for_params</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="n">annos</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">python_attr_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">annos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">buff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="n">java_attr_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">buff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">annos</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">unpack</span><span class="p">(</span><span class="n">buff</span><span class="p">)</span> <span class="k">as</span> <span class="n">up</span><span class="p">:</span>
                    <span class="n">unp</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">up</span><span class="o">.</span><span class="n">unpack_objects</span><span class="p">,</span>
                                  <span class="n">JavaAnnotation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpool</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">for_params</span><span class="p">:</span>
                        <span class="p">(</span><span class="n">param_count</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">up</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_B</span><span class="p">)</span>
                        <span class="n">annos</span> <span class="o">=</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">unp</span><span class="p">())</span> <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">param_count</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">annos</span> <span class="o">=</span> <span class="n">unp</span><span class="p">()</span>
                    <span class="n">annos</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">annos</span><span class="p">)</span>

            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">python_attr_name</span><span class="p">,</span> <span class="n">annos</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">annos</span>


<div class="viewcode-block" id="JavaMemberInfo.get_annotations"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.get_annotations">[docs]</a>    <span class="k">def</span> <span class="nf">get_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The RuntimeVisibleAnnotations attribute. A tuple of JavaAnnotation</span>
<span class="sd">        instances</span>

<span class="sd">        reference: http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.7.16</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_annotations</span><span class="p">(</span><span class="s2">&quot;annotations&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;RuntimeVisibleAnnotations&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaMemberInfo.get_invisible_annotations"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.get_invisible_annotations">[docs]</a>    <span class="k">def</span> <span class="nf">get_invisible_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The RuntimeInvisibleAnnotations attribute. A tuple of</span>
<span class="sd">        JavaAnnotation instances</span>

<span class="sd">        reference: http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.7.17</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_annotations</span><span class="p">(</span><span class="s2">&quot;invisible_annotations&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;RuntimeInvisibleAnnotations&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaMemberInfo.get_parameter_annotations"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.get_parameter_annotations">[docs]</a>    <span class="k">def</span> <span class="nf">get_parameter_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The RuntimeVisibleParameterAnnotations attribute.  Contains a</span>
<span class="sd">        tuple of JavaAnnotation instances for each param.</span>

<span class="sd">        reference: http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.7.18</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_annotations</span><span class="p">(</span><span class="s2">&quot;parameter_annotations&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;RuntimeVisibleParameterAnnotations&quot;</span><span class="p">,</span>
                                     <span class="n">for_params</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaMemberInfo.get_invisible_parameter_annotations"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.get_invisible_parameter_annotations">[docs]</a>    <span class="k">def</span> <span class="nf">get_invisible_parameter_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The RuntimeInvisibleParameterAnnotations attribute.  Contains a</span>
<span class="sd">        tuple of JavaAnnotation instances for each param.</span>

<span class="sd">        reference: http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.7.19</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_annotations</span><span class="p">(</span><span class="s2">&quot;invisible_parameter_annotations&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;RuntimeInvisibleParameterAnnotations&quot;</span><span class="p">,</span>
                                     <span class="n">for_params</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaMemberInfo.get_annotationdefault"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.get_annotationdefault">[docs]</a>    <span class="k">def</span> <span class="nf">get_annotationdefault</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The AnnotationDefault attribute, only present upon fields in an</span>
<span class="sd">        annotaion.</span>

<span class="sd">        reference: http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.7.20</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

        <span class="n">buff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;AnnotationDefault&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">buff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">with</span> <span class="n">unpack</span><span class="p">(</span><span class="n">buff</span><span class="p">)</span> <span class="k">as</span> <span class="n">up</span><span class="p">:</span>
            <span class="p">(</span><span class="n">ti</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">up</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_H</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ti</span></div>


<div class="viewcode-block" id="JavaMemberInfo.deref_annotationdefault"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.deref_annotationdefault">[docs]</a>    <span class="k">def</span> <span class="nf">deref_annotationdefault</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        dereferences the AnnotationDefault attribute</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_annotationdefault</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaMemberInfo.get_code"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.get_code">[docs]</a>    <span class="k">def</span> <span class="nf">get_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the JavaCodeInfo of this member if it is a non-abstract method,</span>
<span class="sd">        None otherwise</span>

<span class="sd">        reference: http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.7.3</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

        <span class="n">buff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;Code&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">buff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">with</span> <span class="n">unpack</span><span class="p">(</span><span class="n">buff</span><span class="p">)</span> <span class="k">as</span> <span class="n">up</span><span class="p">:</span>
            <span class="n">code</span> <span class="o">=</span> <span class="n">JavaCodeInfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpool</span><span class="p">)</span>
            <span class="n">code</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">up</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">code</span></div>


<div class="viewcode-block" id="JavaMemberInfo.get_exceptions"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.get_exceptions">[docs]</a>    <span class="k">def</span> <span class="nf">get_exceptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a tuple of class names for the exception types this method may</span>
<span class="sd">        raise, or None if this is not a method</span>

<span class="sd">        reference: http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.7.5</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

        <span class="n">buff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;Exceptions&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">buff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">()</span>

        <span class="k">with</span> <span class="n">unpack</span><span class="p">(</span><span class="n">buff</span><span class="p">)</span> <span class="k">as</span> <span class="n">up</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">e</span>
                         <span class="ow">in</span> <span class="n">up</span><span class="o">.</span><span class="n">unpack_struct_array</span><span class="p">(</span><span class="n">_H</span><span class="p">))</span></div>


<div class="viewcode-block" id="JavaMemberInfo.get_constantvalue"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.get_constantvalue">[docs]</a>    <span class="k">def</span> <span class="nf">get_constantvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the constant pool index for this field, or None if this is not a</span>
<span class="sd">        contant field</span>

<span class="sd">        reference: http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.7.2</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

        <span class="n">buff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;ConstantValue&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">buff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">with</span> <span class="n">unpack</span><span class="p">(</span><span class="n">buff</span><span class="p">)</span> <span class="k">as</span> <span class="n">up</span><span class="p">:</span>
            <span class="p">(</span><span class="n">cval_ref</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">up</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_H</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cval_ref</span></div>


<div class="viewcode-block" id="JavaMemberInfo.deref_constantvalue"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.deref_constantvalue">[docs]</a>    <span class="k">def</span> <span class="nf">deref_constantvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the value in the constant pool at the get_constantvalue() index</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_constantvalue</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaMemberInfo.get_type_descriptor"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.get_type_descriptor">[docs]</a>    <span class="k">def</span> <span class="nf">get_type_descriptor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the type descriptor for a field, or the return type descriptor for</span>
<span class="sd">        a method. Type descriptors are shorthand identifiers for the</span>
<span class="sd">        builtin java types.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">_typeseq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_descriptor</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="JavaMemberInfo.get_arg_type_descriptors"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.get_arg_type_descriptors">[docs]</a>    <span class="k">def</span> <span class="nf">get_arg_type_descriptors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The parameter type descriptor list for a method, or None for a</span>
<span class="sd">        field.  Type descriptors are shorthand identifiers for the</span>
<span class="sd">        builtin java types.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_method</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">()</span>

        <span class="n">desc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_descriptor</span><span class="p">()</span>

        <span class="n">tp</span> <span class="o">=</span> <span class="n">_typeseq</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span>
        <span class="n">tp</span> <span class="o">=</span> <span class="n">_typeseq</span><span class="p">(</span><span class="n">tp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">tp</span></div>


<div class="viewcode-block" id="JavaMemberInfo.pretty_type"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.pretty_type">[docs]</a>    <span class="k">def</span> <span class="nf">pretty_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The pretty version of get_type_descriptor.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">_pretty_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_type_descriptor</span><span class="p">())</span></div>


<div class="viewcode-block" id="JavaMemberInfo.pretty_arg_types"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.pretty_arg_types">[docs]</a>    <span class="k">def</span> <span class="nf">pretty_arg_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sequence of pretty argument types.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_method</span><span class="p">:</span>
            <span class="n">types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_arg_type_descriptors</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">_pretty_type</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">types</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">()</span></div>


<div class="viewcode-block" id="JavaMemberInfo.pretty_descriptor"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.pretty_descriptor">[docs]</a>    <span class="k">def</span> <span class="nf">pretty_descriptor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        assemble a long member name from access flags, type, argument</span>
<span class="sd">        types, exceptions as applicable</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">f</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pretty_access_flags</span><span class="p">())</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pretty_type</span><span class="p">()</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
        <span class="n">t</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pretty_exceptions</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="s2">&quot;&lt;init&gt;&quot;</span><span class="p">:</span>
            <span class="c1"># we pretend that there&#39;s no return type, even though it&#39;s</span>
            <span class="c1"># V for constructors</span>
            <span class="n">p</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_method</span><span class="p">:</span>
            <span class="c1"># stick the name and args together so there&#39;s no space</span>
            <span class="n">n</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pretty_arg_types</span><span class="p">()))</span>

        <span class="k">if</span> <span class="n">t</span><span class="p">:</span>
            <span class="c1"># assemble any throws as necessary</span>
            <span class="n">t</span> <span class="o">=</span> <span class="s2">&quot;throws &quot;</span> <span class="o">+</span> <span class="n">t</span>

        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">z</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="k">if</span> <span class="n">z</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_pretty_access_flags_gen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">showall</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_public</span><span class="p">():</span>
            <span class="k">yield</span> <span class="s2">&quot;public&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_private</span><span class="p">():</span>
            <span class="k">yield</span> <span class="s2">&quot;private&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_protected</span><span class="p">():</span>
            <span class="k">yield</span> <span class="s2">&quot;protected&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_static</span><span class="p">():</span>
            <span class="k">yield</span> <span class="s2">&quot;static&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_final</span><span class="p">():</span>
            <span class="k">yield</span> <span class="s2">&quot;final&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_strict</span><span class="p">():</span>
            <span class="k">yield</span> <span class="s2">&quot;strict&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_native</span><span class="p">():</span>
            <span class="k">yield</span> <span class="s2">&quot;native&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_abstract</span><span class="p">():</span>
            <span class="k">yield</span> <span class="s2">&quot;abstract&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_enum</span><span class="p">():</span>
            <span class="k">yield</span> <span class="s2">&quot;enum&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_module</span><span class="p">():</span>
            <span class="k">yield</span> <span class="s2">&quot;module&quot;</span>

        <span class="k">if</span> <span class="n">showall</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_synthetic</span><span class="p">():</span>
            <span class="k">yield</span> <span class="s2">&quot;synthetic&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_method</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_synchronized</span><span class="p">():</span>
                <span class="k">yield</span> <span class="s2">&quot;synchronized&quot;</span>

            <span class="k">if</span> <span class="n">showall</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_bridge</span><span class="p">():</span>
                <span class="k">yield</span> <span class="s2">&quot;bridge&quot;</span>
            <span class="k">if</span> <span class="n">showall</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_varargs</span><span class="p">():</span>
                <span class="k">yield</span> <span class="s2">&quot;varargs&quot;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_transient</span><span class="p">():</span>
                <span class="k">yield</span> <span class="s2">&quot;transient&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_volatile</span><span class="p">():</span>
                <span class="k">yield</span> <span class="s2">&quot;volatile&quot;</span>


<div class="viewcode-block" id="JavaMemberInfo.pretty_access_flags"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.pretty_access_flags">[docs]</a>    <span class="k">def</span> <span class="nf">pretty_access_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">showall</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        generator of the keywords determined from the access flags</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pretty_access_flags_gen</span><span class="p">(</span><span class="n">showall</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaMemberInfo.pretty_exceptions"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.pretty_exceptions">[docs]</a>    <span class="k">def</span> <span class="nf">pretty_exceptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        sequence of pretty names for get_exceptions()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">_pretty_class</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_exceptions</span><span class="p">())</span></div>


<div class="viewcode-block" id="JavaMemberInfo.get_identifier"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.get_identifier">[docs]</a>    <span class="k">def</span> <span class="nf">get_identifier</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For methods this is the return type, the name and the (non-pretty)</span>
<span class="sd">        argument descriptor. For fields it is simply the name.</span>

<span class="sd">        The return-type of methods is attached to the identifier when</span>
<span class="sd">        it is a bridge method, which can technically allow two methods</span>
<span class="sd">        with the same name and argument type list, but with different</span>
<span class="sd">        return type.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ident</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_method</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_arg_type_descriptors</span><span class="p">())</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_bridge</span><span class="p">():</span>
                <span class="n">ident</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">):</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ident</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_descriptor</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ident</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ident</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ident</span></div>


<div class="viewcode-block" id="JavaMemberInfo.pretty_identifier"><a class="viewcode-back" href="../../javatools/#javatools.JavaMemberInfo.pretty_identifier">[docs]</a>    <span class="k">def</span> <span class="nf">pretty_identifier</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The pretty version of get_identifier</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ident</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_method</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pretty_arg_types</span><span class="p">())</span>
            <span class="n">ident</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ident</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ident</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pretty_type</span><span class="p">())</span></div></div>


<div class="viewcode-block" id="JavaCodeInfo"><a class="viewcode-back" href="../../javatools/#javatools.JavaCodeInfo">[docs]</a><span class="k">class</span> <span class="nc">JavaCodeInfo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The &#39;Code&#39; attribue of a method member of a java class</span>

<span class="sd">    reference: http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.7.3</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cpool</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpool</span> <span class="o">=</span> <span class="n">cpool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attribs</span> <span class="o">=</span> <span class="n">JavaAttributes</span><span class="p">(</span><span class="n">cpool</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_stack</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_locals</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exceptions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>

        <span class="c1"># cache of disassembled code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dis_code</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># cache of linenumbertable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lnt</span> <span class="o">=</span> <span class="kc">None</span>


<div class="viewcode-block" id="JavaCodeInfo.deref_const"><a class="viewcode-back" href="../../javatools/#javatools.JavaCodeInfo.deref_const">[docs]</a>    <span class="k">def</span> <span class="nf">deref_const</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        dereference a constant by index from the parent constant pool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpool</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaCodeInfo.get_attribute"><a class="viewcode-back" href="../../javatools/#javatools.JavaCodeInfo.get_attribute">[docs]</a>    <span class="k">def</span> <span class="nf">get_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get an attribute buffer by name</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attribs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaCodeInfo.unpack"><a class="viewcode-back" href="../../javatools/#javatools.JavaCodeInfo.unpack">[docs]</a>    <span class="k">def</span> <span class="nf">unpack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unpacker</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        unpacks a code block from a buffer. Updates the internal structure</span>
<span class="sd">        of this instance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_HHI</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">max_stack</span> <span class="o">=</span> <span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_locals</span> <span class="o">=</span> <span class="n">b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

        <span class="n">uobjs</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack_objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exceptions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">uobjs</span><span class="p">(</span><span class="n">JavaExceptionInfo</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">attribs</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">unpacker</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaCodeInfo.get_linenumbertable"><a class="viewcode-back" href="../../javatools/#javatools.JavaCodeInfo.get_linenumbertable">[docs]</a>    <span class="k">def</span> <span class="nf">get_linenumbertable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a sequence of (code_offset, line_number) pairs.</span>

<span class="sd">        reference: http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.7.12</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

        <span class="n">lnt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lnt</span>
        <span class="k">if</span> <span class="n">lnt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">buff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;LineNumberTable&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">buff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">lnt</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">unpack</span><span class="p">(</span><span class="n">buff</span><span class="p">)</span> <span class="k">as</span> <span class="n">up</span><span class="p">:</span>
                    <span class="n">lnt</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">up</span><span class="o">.</span><span class="n">unpack_struct_array</span><span class="p">(</span><span class="n">_HH</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lnt</span> <span class="o">=</span> <span class="n">lnt</span>
        <span class="k">return</span> <span class="n">lnt</span></div>


<div class="viewcode-block" id="JavaCodeInfo.get_relativelinenumbertable"><a class="viewcode-back" href="../../javatools/#javatools.JavaCodeInfo.get_relativelinenumbertable">[docs]</a>    <span class="k">def</span> <span class="nf">get_relativelinenumbertable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a sequence of (code_offset, line_number) pairs. Similar to the</span>
<span class="sd">        get_linenumbertable method, but the line numbers start at 0</span>
<span class="sd">        (they are relative to the method, not to the class file)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">lnt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_linenumbertable</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">lnt</span><span class="p">:</span>
            <span class="n">lineoff</span> <span class="o">=</span> <span class="n">lnt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">o</span><span class="p">,</span> <span class="n">l</span> <span class="o">-</span> <span class="n">lineoff</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span> <span class="ow">in</span> <span class="n">lnt</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">()</span></div>


<div class="viewcode-block" id="JavaCodeInfo.get_localvariabletable"><a class="viewcode-back" href="../../javatools/#javatools.JavaCodeInfo.get_localvariabletable">[docs]</a>    <span class="k">def</span> <span class="nf">get_localvariabletable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a sequence of (code_offset, length, name_index, desc_index, index)</span>
<span class="sd">        tuples</span>

<span class="sd">        reference: http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.7.13</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

        <span class="n">buff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;LocalVariableTable&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">buff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">()</span>

        <span class="k">with</span> <span class="n">unpack</span><span class="p">(</span><span class="n">buff</span><span class="p">)</span> <span class="k">as</span> <span class="n">up</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">up</span><span class="o">.</span><span class="n">unpack_struct_array</span><span class="p">(</span><span class="n">_HHHHH</span><span class="p">))</span></div>


<div class="viewcode-block" id="JavaCodeInfo.get_localvariabletypetable"><a class="viewcode-back" href="../../javatools/#javatools.JavaCodeInfo.get_localvariabletypetable">[docs]</a>    <span class="k">def</span> <span class="nf">get_localvariabletypetable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a sequence of (code_offset, length, name_index, signature_index,</span>
<span class="sd">        index) tuples</span>

<span class="sd">        reference: http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.7.14</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

        <span class="n">buff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;LocalVariableTypeTable&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">buff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">()</span>

        <span class="k">with</span> <span class="n">unpack</span><span class="p">(</span><span class="n">buff</span><span class="p">)</span> <span class="k">as</span> <span class="n">up</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">up</span><span class="o">.</span><span class="n">unpack_struct_array</span><span class="p">(</span><span class="n">_HHHHH</span><span class="p">))</span></div>


<div class="viewcode-block" id="JavaCodeInfo.get_line_for_offset"><a class="viewcode-back" href="../../javatools/#javatools.JavaCodeInfo.get_line_for_offset">[docs]</a>    <span class="k">def</span> <span class="nf">get_line_for_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code_offset</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns the line number given a code offset</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">prev_line</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_linenumbertable</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="n">code_offset</span><span class="p">:</span>
                <span class="n">prev_line</span> <span class="o">=</span> <span class="n">line</span>
            <span class="k">elif</span> <span class="n">offset</span> <span class="o">==</span> <span class="n">code_offset</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">line</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">prev_line</span>

        <span class="k">return</span> <span class="n">prev_line</span></div>


<div class="viewcode-block" id="JavaCodeInfo.iter_code_by_lines"><a class="viewcode-back" href="../../javatools/#javatools.JavaCodeInfo.iter_code_by_lines">[docs]</a>    <span class="k">def</span> <span class="nf">iter_code_by_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ((abs_line, rel_line, [(offset, code, args), ...]),</span>
<span class="sd">         ...)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">lnt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_linenumbertable</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">lnt</span><span class="p">:</span>
            <span class="k">yield</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">disassemble</span><span class="p">())</span>
            <span class="k">return</span>

        <span class="n">lnt_offset</span> <span class="o">=</span> <span class="n">lnt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">cur_line</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">current</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">codelet</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disassemble</span><span class="p">():</span>
            <span class="n">abs_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_line_for_offset</span><span class="p">(</span><span class="n">codelet</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">cur_line</span> <span class="o">==</span> <span class="n">abs_line</span><span class="p">:</span>
                <span class="n">current</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">codelet</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cur_line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="p">(</span><span class="n">cur_line</span><span class="p">,</span> <span class="n">cur_line</span> <span class="o">-</span> <span class="n">lnt_offset</span><span class="p">,</span> <span class="n">current</span><span class="p">)</span>
                <span class="n">cur_line</span> <span class="o">=</span> <span class="n">abs_line</span>
                <span class="n">current</span> <span class="o">=</span> <span class="p">[</span><span class="n">codelet</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">current</span><span class="p">:</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">cur_line</span><span class="p">,</span> <span class="n">cur_line</span> <span class="o">-</span> <span class="n">lnt_offset</span><span class="p">,</span> <span class="n">current</span><span class="p">)</span></div>


<div class="viewcode-block" id="JavaCodeInfo.disassemble"><a class="viewcode-back" href="../../javatools/#javatools.JavaCodeInfo.disassemble">[docs]</a>    <span class="k">def</span> <span class="nf">disassemble</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        disassembles the underlying bytecode instructions and generates a</span>
<span class="sd">        sequence of (offset, code, args) tuples</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dis_code</span>
        <span class="k">if</span> <span class="n">dis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dis</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">disassemble</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dis_code</span> <span class="o">=</span> <span class="n">dis</span>

        <span class="k">return</span> <span class="n">dis</span></div></div>


<div class="viewcode-block" id="JavaExceptionInfo"><a class="viewcode-back" href="../../javatools/#javatools.JavaExceptionInfo">[docs]</a><span class="k">class</span> <span class="nc">JavaExceptionInfo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Information about an exception handler entry in an exception table</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpool</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">cpool</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">start_pc</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_pc</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler_pc</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">catch_type_ref</span> <span class="o">=</span> <span class="mi">0</span>


<div class="viewcode-block" id="JavaExceptionInfo.unpack"><a class="viewcode-back" href="../../javatools/#javatools.JavaExceptionInfo.unpack">[docs]</a>    <span class="k">def</span> <span class="nf">unpack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unpacker</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        unpacks an exception handler entry in an exception table. Updates</span>
<span class="sd">        the internal structure of this instance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_HHHH</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">start_pc</span> <span class="o">=</span> <span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_pc</span> <span class="o">=</span> <span class="n">b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler_pc</span> <span class="o">=</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">catch_type_ref</span> <span class="o">=</span> <span class="n">d</span></div>


<div class="viewcode-block" id="JavaExceptionInfo.get_catch_type"><a class="viewcode-back" href="../../javatools/#javatools.JavaExceptionInfo.get_catch_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_catch_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        dereferences the catch_type_ref to its class name, or None if the</span>
<span class="sd">        catch type is unspecified</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">catch_type_ref</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpool</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catch_type_ref</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="JavaExceptionInfo.pretty_catch_type"><a class="viewcode-back" href="../../javatools/#javatools.JavaExceptionInfo.pretty_catch_type">[docs]</a>    <span class="k">def</span> <span class="nf">pretty_catch_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        pretty version of `get_catch_type()`</span>

<span class="sd">        If the catch type isn&#39;t specified, returns &quot;any&quot;. Otherwise</span>
<span class="sd">        prefixes the pretty class name with the text &quot;Class &quot;. This is</span>
<span class="sd">        done to emulate the javap output for exceptions caught in a</span>
<span class="sd">        body of code.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_catch_type</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ct</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Class &quot;</span> <span class="o">+</span> <span class="n">_pretty_class</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;any&quot;</span></div>


<div class="viewcode-block" id="JavaExceptionInfo.info"><a class="viewcode-back" href="../../javatools/#javatools.JavaExceptionInfo.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        tuple of the start_pc, end_pc, handler_pc and catch_type_ref</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_pc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_pc</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handler_pc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_catch_type</span><span class="p">())</span></div>


    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">JavaExceptionInfo</span><span class="p">)</span> <span class="ow">and</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">info</span><span class="p">()))</span>


    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>


    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">())</span></div>


<div class="viewcode-block" id="JavaInnerClassInfo"><a class="viewcode-back" href="../../javatools/#javatools.JavaInnerClassInfo">[docs]</a><span class="k">class</span> <span class="nc">JavaInnerClassInfo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Information about an inner class</span>

<span class="sd">    reference: http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.7.6</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cpool</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpool</span> <span class="o">=</span> <span class="n">cpool</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">inner_info_ref</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outer_info_ref</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_ref</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">=</span> <span class="mi">0</span>


<div class="viewcode-block" id="JavaInnerClassInfo.unpack"><a class="viewcode-back" href="../../javatools/#javatools.JavaInnerClassInfo.unpack">[docs]</a>    <span class="k">def</span> <span class="nf">unpack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unpacker</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        unpack this instance with data from unpacker</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_HHHH</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">inner_info_ref</span> <span class="o">=</span> <span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outer_info_ref</span> <span class="o">=</span> <span class="n">b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_ref</span> <span class="o">=</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">=</span> <span class="n">d</span></div>


<div class="viewcode-block" id="JavaInnerClassInfo.get_name"><a class="viewcode-back" href="../../javatools/#javatools.JavaInnerClassInfo.get_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the name of this inner-class</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpool</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name_ref</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="JavaAnnotation"><a class="viewcode-back" href="../../javatools/#javatools.JavaAnnotation">[docs]</a><span class="k">class</span> <span class="nc">JavaAnnotation</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Java Annotations info</span>

<span class="sd">    reference: http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.7.16</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cpool</span><span class="p">):</span>
        <span class="nb">dict</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpool</span> <span class="o">=</span> <span class="n">cpool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type_ref</span> <span class="o">=</span> <span class="mi">0</span>


<div class="viewcode-block" id="JavaAnnotation.unpack"><a class="viewcode-back" href="../../javatools/#javatools.JavaAnnotation.unpack">[docs]</a>    <span class="k">def</span> <span class="nf">unpack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unpacker</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type_ref</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_HH</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
            <span class="n">key_ref</span><span class="p">,</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_H</span><span class="p">)</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">_unpack_annotation_val</span><span class="p">(</span><span class="n">unpacker</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpool</span><span class="p">)</span>

            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpool</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">key_ref</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span></div>


<div class="viewcode-block" id="JavaAnnotation.pretty_type"><a class="viewcode-back" href="../../javatools/#javatools.JavaAnnotation.pretty_type">[docs]</a>    <span class="k">def</span> <span class="nf">pretty_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_pretty_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpool</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type_ref</span><span class="p">))</span></div>


<div class="viewcode-block" id="JavaAnnotation.pretty_elements"><a class="viewcode-back" href="../../javatools/#javatools.JavaAnnotation.pretty_elements">[docs]</a>    <span class="k">def</span> <span class="nf">pretty_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">_pretty_annotation_val</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpool</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="JavaAnnotation.pretty_annotation"><a class="viewcode-back" href="../../javatools/#javatools.JavaAnnotation.pretty_annotation">[docs]</a>    <span class="k">def</span> <span class="nf">pretty_annotation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">typename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pretty_type</span><span class="p">()</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pretty_elements</span><span class="p">()</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">typename</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">elements</span><span class="p">))</span></div>


    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">JavaAnnotation</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># if we have a different type name, not equal</span>
        <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpool</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type_ref</span><span class="p">)</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">cpool</span><span class="o">.</span><span class="n">deref_const</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">type_ref</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">left</span> <span class="o">!=</span> <span class="n">right</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># if we have differing sets of keys, not equal</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># for each of the key/val pairs, check equality</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">lval</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">rval</span> <span class="o">=</span> <span class="n">other</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_annotation_val_eq</span><span class="p">(</span><span class="n">lval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lval</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpool</span><span class="p">,</span>
                                      <span class="n">rval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rval</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">other</span><span class="o">.</span><span class="n">cpool</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>


    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;@&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pretty_annotation</span><span class="p">()</span></div>


<span class="k">def</span> <span class="nf">_annotation_val_eq</span><span class="p">(</span><span class="n">left_tag</span><span class="p">,</span> <span class="n">left_data</span><span class="p">,</span> <span class="n">left_cpool</span><span class="p">,</span>
                       <span class="n">right_tag</span><span class="p">,</span> <span class="n">right_data</span><span class="p">,</span> <span class="n">right_cpool</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">left_tag</span> <span class="o">!=</span> <span class="n">right_tag</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="n">lconst</span> <span class="o">=</span> <span class="n">left_cpool</span><span class="o">.</span><span class="n">deref_const</span>
    <span class="n">rconst</span> <span class="o">=</span> <span class="n">right_cpool</span><span class="o">.</span><span class="n">deref_const</span>

    <span class="k">if</span> <span class="n">left_tag</span> <span class="ow">in</span> <span class="s1">&#39;BCDFIJSZs&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lconst</span><span class="p">(</span><span class="n">left_data</span><span class="p">)</span> <span class="o">==</span> <span class="n">rconst</span><span class="p">(</span><span class="n">right_data</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">left_tag</span> <span class="o">==</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">lconst</span><span class="p">(</span><span class="n">left_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="n">rconst</span><span class="p">(</span><span class="n">right_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="ow">and</span>
                <span class="p">(</span><span class="n">lconst</span><span class="p">(</span><span class="n">left_data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="n">rconst</span><span class="p">(</span><span class="n">right_data</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>

    <span class="k">elif</span> <span class="n">left_tag</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lconst</span><span class="p">(</span><span class="n">left_data</span><span class="p">)</span> <span class="o">==</span> <span class="n">rconst</span><span class="p">(</span><span class="n">right_data</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">left_tag</span> <span class="o">==</span> <span class="s1">&#39;@&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">left_data</span> <span class="o">==</span> <span class="n">right_data</span>

    <span class="k">elif</span> <span class="n">left_tag</span> <span class="o">==</span> <span class="s1">&#39;[&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">left_data</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">right_data</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">left_data</span><span class="p">)):</span>
            <span class="n">ld</span> <span class="o">=</span> <span class="n">left_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">rd</span> <span class="o">=</span> <span class="n">right_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_annotation_val_eq</span><span class="p">(</span><span class="n">ld</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ld</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">left_cpool</span><span class="p">,</span>
                                      <span class="n">rd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">right_cpool</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>


<span class="k">def</span> <span class="nf">_unpack_annotation_val</span><span class="p">(</span><span class="n">unpacker</span><span class="p">,</span> <span class="n">cpool</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    tag, data tuple of an annotation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tag</span><span class="p">,</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_B</span><span class="p">)</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="s1">&#39;BCDFIJSZs&#39;</span><span class="p">:</span>
        <span class="n">data</span><span class="p">,</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_H</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_HH</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>
        <span class="n">data</span><span class="p">,</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_H</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;@&#39;</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">JavaAnnotation</span><span class="p">(</span><span class="n">cpool</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">unpacker</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;[&#39;</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">count</span><span class="p">,</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_H</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_unpack_annotation_val</span><span class="p">(</span><span class="n">unpacker</span><span class="p">,</span> <span class="n">cpool</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">Unimplemented</span><span class="p">(</span><span class="s2">&quot;Unknown tag </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">tag</span><span class="p">,</span> <span class="n">data</span>


<span class="k">def</span> <span class="nf">_pretty_annotation_val</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">cpool</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    a pretty display of a tag and data pair annotation value</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tag</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">val</span>

    <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="s1">&#39;BCDFIJSZs&#39;</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">#</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;e#</span><span class="si">%i</span><span class="s2">.#</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">data</span>

    <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;c#</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">data</span>

    <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;@&#39;</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">pretty_annotation</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;[&#39;</span><span class="p">:</span>
        <span class="n">combine</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">combine</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_pretty_annotation_val</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">cpool</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">combine</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span>


<span class="c1"># -----</span>
<span class="c1"># Utility functions for turning major/minor versions into JVM releases</span>
<span class="c1"># Each entry is a tuple of minimum version and maxiumum version,</span>
<span class="c1"># inclusive, and the string of the platform version.</span>


<span class="n">_platforms</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">((</span><span class="mi">45</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="s2">&quot;1.0.2&quot;</span><span class="p">),</span>
    <span class="p">((</span><span class="mi">45</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="mi">65535</span><span class="p">),</span> <span class="s2">&quot;1.1&quot;</span><span class="p">),</span>
    <span class="p">((</span><span class="mi">46</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">46</span><span class="p">,</span> <span class="mi">65535</span><span class="p">),</span> <span class="s2">&quot;1.2&quot;</span><span class="p">),</span>
    <span class="p">((</span><span class="mi">47</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">47</span><span class="p">,</span> <span class="mi">65535</span><span class="p">),</span> <span class="s2">&quot;1.3&quot;</span><span class="p">),</span>
    <span class="p">((</span><span class="mi">48</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">48</span><span class="p">,</span> <span class="mi">65535</span><span class="p">),</span> <span class="s2">&quot;1.4&quot;</span><span class="p">),</span>
    <span class="p">((</span><span class="mi">49</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">49</span><span class="p">,</span> <span class="mi">65535</span><span class="p">),</span> <span class="s2">&quot;1.5&quot;</span><span class="p">),</span>
    <span class="p">((</span><span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">65535</span><span class="p">),</span> <span class="s2">&quot;1.6&quot;</span><span class="p">),</span>
    <span class="p">((</span><span class="mi">51</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">51</span><span class="p">,</span> <span class="mi">65535</span><span class="p">),</span> <span class="s2">&quot;1.7&quot;</span><span class="p">),</span>
    <span class="p">((</span><span class="mi">52</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">52</span><span class="p">,</span> <span class="mi">65535</span><span class="p">),</span> <span class="s2">&quot;1.8&quot;</span><span class="p">),</span> <span class="p">)</span>


<div class="viewcode-block" id="platform_from_version"><a class="viewcode-back" href="../../javatools/#javatools.platform_from_version">[docs]</a><span class="k">def</span> <span class="nf">platform_from_version</span><span class="p">(</span><span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns the minimum platform version that can load the given class</span>
<span class="sd">    version indicated by major.minor or None if no known platforms</span>
<span class="sd">    match the given version</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">_platforms</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">low</span> <span class="o">&lt;=</span> <span class="n">v</span> <span class="o">&lt;=</span> <span class="n">high</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">name</span>
    <span class="k">return</span> <span class="kc">None</span></div>


<span class="c1"># -----</span>
<span class="c1"># Utility functions for the constants pool</span>


<span class="k">def</span> <span class="nf">_unpack_const_item</span><span class="p">(</span><span class="n">unpacker</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    unpack a constant pool item, which will consist of a type byte</span>
<span class="sd">    (see the CONST_ values in this module) and a value of the</span>
<span class="sd">    appropriate type</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="p">(</span><span class="n">typecode</span><span class="p">,)</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_B</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">typecode</span> <span class="o">==</span> <span class="n">CONST_Utf8</span><span class="p">:</span>
        <span class="p">(</span><span class="n">slen</span><span class="p">,)</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_H</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">slen</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
            <span class="c1"># easiest hack to handle java&#39;s modified utf-8 encoding</span>
            <span class="c1"># also we want at least some data, thus we ignore</span>
            <span class="c1"># unknown characters</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xC0\x80</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)</span> \
                     <span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">typecode</span> <span class="o">==</span> <span class="n">CONST_Integer</span><span class="p">:</span>
        <span class="p">(</span><span class="n">val</span><span class="p">,)</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;i&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">typecode</span> <span class="o">==</span> <span class="n">CONST_Float</span><span class="p">:</span>
        <span class="p">(</span><span class="n">val</span><span class="p">,)</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;f&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">typecode</span> <span class="o">==</span> <span class="n">CONST_Long</span><span class="p">:</span>
        <span class="p">(</span><span class="n">val</span><span class="p">,)</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;q&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">typecode</span> <span class="o">==</span> <span class="n">CONST_Double</span><span class="p">:</span>
        <span class="p">(</span><span class="n">val</span><span class="p">,)</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;d&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">typecode</span> <span class="ow">in</span> <span class="p">(</span><span class="n">CONST_Class</span><span class="p">,</span> <span class="n">CONST_String</span><span class="p">,</span> <span class="n">CONST_MethodType</span><span class="p">,</span>
                      <span class="n">CONST_Module</span><span class="p">,</span> <span class="n">CONST_Package</span><span class="p">):</span>
        <span class="p">(</span><span class="n">val</span><span class="p">,)</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_H</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">typecode</span> <span class="ow">in</span> <span class="p">(</span><span class="n">CONST_Fieldref</span><span class="p">,</span> <span class="n">CONST_Methodref</span><span class="p">,</span>
                      <span class="n">CONST_InterfaceMethodref</span><span class="p">,</span> <span class="n">CONST_NameAndType</span><span class="p">,</span>
                      <span class="n">CONST_ModuleId</span><span class="p">,</span> <span class="n">CONST_InvokeDynamic</span><span class="p">,</span> <span class="n">CONST_Dynamic</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_HH</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">typecode</span> <span class="o">==</span> <span class="n">CONST_MethodHandle</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_BH</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">typecode</span> <span class="o">==</span> <span class="n">CONST_MethodType</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">unpacker</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_H</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">UnknownConstantPoolTagException</span><span class="p">(</span>
            <span class="s2">&quot;unknown constant type </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">typecode</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">typecode</span><span class="p">,</span> <span class="n">val</span>


<span class="k">def</span> <span class="nf">_pretty_const_type_val</span><span class="p">(</span><span class="n">typecode</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    given a typecode and a value, returns the appropriate pretty</span>
<span class="sd">    version of that value (not the dereferenced data)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">typecode</span> <span class="o">==</span> <span class="n">CONST_Utf8</span><span class="p">:</span>
        <span class="n">typestr</span> <span class="o">=</span> <span class="s2">&quot;Utf8&quot;</span>  <span class="c1"># formerly Asciz, which was considered Java bug</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>  <span class="c1"># Py2, val is &#39;unicode&#39;</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">)[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># trim off the surrounding u&quot;&quot; (HACK)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># trim off the surrounding &quot;&quot; (HACK)</span>
    <span class="k">elif</span> <span class="n">typecode</span> <span class="o">==</span> <span class="n">CONST_Integer</span><span class="p">:</span>
        <span class="n">typestr</span> <span class="o">=</span> <span class="s2">&quot;int&quot;</span>
    <span class="k">elif</span> <span class="n">typecode</span> <span class="o">==</span> <span class="n">CONST_Float</span><span class="p">:</span>
        <span class="n">typestr</span> <span class="o">=</span> <span class="s2">&quot;float&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%f</span><span class="s2">f&quot;</span> <span class="o">%</span> <span class="n">val</span>
    <span class="k">elif</span> <span class="n">typecode</span> <span class="o">==</span> <span class="n">CONST_Long</span><span class="p">:</span>
        <span class="n">typestr</span> <span class="o">=</span> <span class="s2">&quot;long&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%i</span><span class="s2">l&quot;</span> <span class="o">%</span> <span class="n">val</span>
    <span class="k">elif</span> <span class="n">typecode</span> <span class="o">==</span> <span class="n">CONST_Double</span><span class="p">:</span>
        <span class="n">typestr</span> <span class="o">=</span> <span class="s2">&quot;double&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%f</span><span class="s2">d&quot;</span> <span class="o">%</span> <span class="n">val</span>
    <span class="k">elif</span> <span class="n">typecode</span> <span class="o">==</span> <span class="n">CONST_Class</span><span class="p">:</span>
        <span class="n">typestr</span> <span class="o">=</span> <span class="s2">&quot;class&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="s2">&quot;#</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">val</span>
    <span class="k">elif</span> <span class="n">typecode</span> <span class="o">==</span> <span class="n">CONST_String</span><span class="p">:</span>
        <span class="n">typestr</span> <span class="o">=</span> <span class="s2">&quot;String&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="s2">&quot;#</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">val</span>
    <span class="k">elif</span> <span class="n">typecode</span> <span class="o">==</span> <span class="n">CONST_Fieldref</span><span class="p">:</span>
        <span class="n">typestr</span> <span class="o">=</span> <span class="s2">&quot;Field&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="s2">&quot;#</span><span class="si">%i</span><span class="s2">.#</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">val</span>
    <span class="k">elif</span> <span class="n">typecode</span> <span class="o">==</span> <span class="n">CONST_Methodref</span><span class="p">:</span>
        <span class="n">typestr</span> <span class="o">=</span> <span class="s2">&quot;Method&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="s2">&quot;#</span><span class="si">%i</span><span class="s2">.#</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">val</span>
    <span class="k">elif</span> <span class="n">typecode</span> <span class="o">==</span> <span class="n">CONST_InterfaceMethodref</span><span class="p">:</span>
        <span class="n">typestr</span> <span class="o">=</span> <span class="s2">&quot;InterfaceMethod&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="s2">&quot;#</span><span class="si">%i</span><span class="s2">.#</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">val</span>
    <span class="k">elif</span> <span class="n">typecode</span> <span class="o">==</span> <span class="n">CONST_NameAndType</span><span class="p">:</span>
        <span class="n">typestr</span> <span class="o">=</span> <span class="s2">&quot;NameAndType&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="s2">&quot;#</span><span class="si">%i</span><span class="s2">:#</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">val</span>
    <span class="k">elif</span> <span class="n">typecode</span> <span class="o">==</span> <span class="n">CONST_ModuleId</span><span class="p">:</span>
        <span class="n">typestr</span> <span class="o">=</span> <span class="s2">&quot;ModuleId&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="s2">&quot;#</span><span class="si">%i</span><span class="s2">@#</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">val</span>
    <span class="k">elif</span> <span class="n">typecode</span> <span class="o">==</span> <span class="n">CONST_MethodHandle</span><span class="p">:</span>
        <span class="n">typestr</span> <span class="o">=</span> <span class="s2">&quot;MethodHandle&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">typecode</span> <span class="o">==</span> <span class="n">CONST_MethodType</span><span class="p">:</span>
        <span class="n">typestr</span> <span class="o">=</span> <span class="s2">&quot;MethodType&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">typecode</span> <span class="o">==</span> <span class="n">CONST_InvokeDynamic</span><span class="p">:</span>
        <span class="n">typestr</span> <span class="o">=</span> <span class="s2">&quot;InvokeDynamic&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">typecode</span> <span class="o">==</span> <span class="n">CONST_Module</span><span class="p">:</span>
        <span class="n">typestr</span> <span class="o">=</span> <span class="s2">&quot;Module&quot;</span>
    <span class="k">elif</span> <span class="n">typecode</span> <span class="o">==</span> <span class="n">CONST_Package</span><span class="p">:</span>
        <span class="n">typestr</span> <span class="o">=</span> <span class="s2">&quot;Package&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">UnknownConstantPoolTagException</span><span class="p">(</span>
            <span class="s2">&quot;unknown constant type </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">typecode</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">typestr</span><span class="p">,</span> <span class="n">val</span>


<span class="c1"># -----</span>
<span class="c1"># Utility functions for dealing with exploding internal type</span>
<span class="c1"># signatures into sequences, and converting type signatures into</span>
<span class="c1"># &quot;pretty&quot; strings</span>


<span class="k">def</span> <span class="nf">pretty_generic</span><span class="p">(</span><span class="n">signature</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pretty version of the given generics signature</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO: this format is annoying in so many ways.</span>

    <span class="k">return</span> <span class="n">signature</span>


<span class="k">def</span> <span class="nf">_next_argsig</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    given a string, find the next complete argument signature and</span>
<span class="sd">    return it and a new string advanced past that point</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="s2">&quot;BCDFIJSVZ&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

    <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;[&quot;</span><span class="p">:</span>
        <span class="n">d</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">_next_argsig</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="n">d</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;L&quot;</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:])</span>

    <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;(&quot;</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:])</span>

    <span class="c1"># Some files may be corrupted and contain bad argument signature (c = &#39;.&#39;).</span>
    <span class="c1"># We do not want to fail on them rather skip this argument signature,</span>
    <span class="c1"># continue and finish successfully.</span>
    <span class="c1"># Example:</span>
    <span class="c1"># s = &#39;[Lcom.sun.glass.ui.EventLoop$State;.clone():java.lang.Object&#39;</span>
    <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;.&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">Unimplemented</span><span class="p">(</span><span class="s2">&quot;_next_argsig is </span><span class="si">%r</span><span class="s2"> in </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">_typeseq_iter</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    iterate through all of the type signatures in a sequence</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">original</span> <span class="o">=</span> <span class="n">s</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">old_s</span> <span class="o">=</span> <span class="n">s</span>
            <span class="n">t</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">_next_argsig</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

            <span class="c1"># If `old_s == s` then it is possible that argument signature</span>
            <span class="c1"># is corrupted which may lead to an infinite loop.</span>
            <span class="c1"># In this case, raise an exception.</span>
            <span class="c1"># Example:</span>
            <span class="c1"># old_s = &quot;LFR1Xdn&quot;</span>
            <span class="c1"># t, s = _next_argsig(&quot;LFR1Xdn&quot;); old_s == s</span>
            <span class="k">if</span> <span class="n">old_s</span> <span class="o">==</span> <span class="n">s</span> <span class="ow">and</span> <span class="n">t</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">Unimplemented</span><span class="p">(</span>
                    <span class="s2">&quot;Infinite loop detected: </span><span class="si">%r</span><span class="s2">, </span><span class="si">%r</span><span class="s2"> = _next_argsig(</span><span class="si">%r</span><span class="s2">)&quot;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">old_s</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="k">yield</span> <span class="n">t</span>

    <span class="k">except</span> <span class="n">Unimplemented</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">Unimplemented</span><span class="p">(</span><span class="s2">&quot;Unknown type signature in </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">original</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_typeseq</span><span class="p">(</span><span class="n">type_s</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    tuple version of _typeseq_iter</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">_typeseq_iter</span><span class="p">(</span><span class="n">type_s</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_pretty_typeseq</span><span class="p">(</span><span class="n">type_s</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    iterator of pretty versions of _typeseq_iter</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">_pretty_type</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">_typeseq</span><span class="p">(</span><span class="n">type_s</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_pretty_type</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="c1"># pylint: disable=R0911, R0912</span>
    <span class="c1"># too many returns, too many branches. Not converting this to a</span>
    <span class="c1"># dict lookup. Waiving instead.</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns the pretty version of a type code</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tc</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">tc</span> <span class="o">==</span> <span class="s2">&quot;V&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;void&quot;</span>

    <span class="k">elif</span> <span class="n">tc</span> <span class="o">==</span> <span class="s2">&quot;Z&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;boolean&quot;</span>

    <span class="k">elif</span> <span class="n">tc</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;char&quot;</span>

    <span class="k">elif</span> <span class="n">tc</span> <span class="o">==</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;byte&quot;</span>

    <span class="k">elif</span> <span class="n">tc</span> <span class="o">==</span> <span class="s2">&quot;S&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;short&quot;</span>

    <span class="k">elif</span> <span class="n">tc</span> <span class="o">==</span> <span class="s2">&quot;I&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;int&quot;</span>

    <span class="k">elif</span> <span class="n">tc</span> <span class="o">==</span> <span class="s2">&quot;J&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;long&quot;</span>

    <span class="k">elif</span> <span class="n">tc</span> <span class="o">==</span> <span class="s2">&quot;D&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;double&quot;</span>

    <span class="k">elif</span> <span class="n">tc</span> <span class="o">==</span> <span class="s2">&quot;F&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;float&quot;</span>

    <span class="k">elif</span> <span class="n">tc</span> <span class="o">==</span> <span class="s2">&quot;L&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_pretty_class</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">offset</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">elif</span> <span class="n">tc</span> <span class="o">==</span> <span class="s2">&quot;[&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">[]&quot;</span> <span class="o">%</span> <span class="n">_pretty_type</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">offset</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">tc</span> <span class="o">==</span> <span class="s2">&quot;(&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_pretty_typeseq</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">offset</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

    <span class="k">elif</span> <span class="n">tc</span> <span class="o">==</span> <span class="s2">&quot;T&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;generic &quot;</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">offset</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">Unimplemented</span><span class="p">(</span><span class="s2">&quot;unknown type, </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">tc</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_pretty_class</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    convert the internal class name representation into what users</span>
<span class="sd">    expect to see. Currently that just means swapping &#39;/&#39; for &#39;.&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># well that&#39;s easy.</span>
    <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>


<span class="c1"># -----</span>
<span class="c1"># Functions for dealing with buffers and files</span>


<div class="viewcode-block" id="is_class"><a class="viewcode-back" href="../../javatools/#javatools.is_class">[docs]</a><span class="k">def</span> <span class="nf">is_class</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    checks that the data (which is a string, buffer, or a stream</span>
<span class="sd">    supporting the read method) has the magic numbers indicating it is</span>
<span class="sd">    a Java class file. Returns False if the magic numbers do not</span>
<span class="sd">    match, or for any errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">as</span> <span class="n">up</span><span class="p">:</span>
            <span class="n">magic</span> <span class="o">=</span> <span class="n">up</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_BBBB</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">magic</span> <span class="o">==</span> <span class="n">JAVA_CLASS_MAGIC</span>

    <span class="k">except</span> <span class="n">UnpackException</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="is_class_file"><a class="viewcode-back" href="../../javatools/#javatools.is_class_file">[docs]</a><span class="k">def</span> <span class="nf">is_class_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    checks whether the given file is a Java class file, by opening it</span>
<span class="sd">    and checking for the magic header</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">JAVA_CLASS_MAGIC</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>      <span class="c1"># Python 2</span>
            <span class="n">c</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">ord</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="n">JAVA_CLASS_MAGIC</span></div>


<div class="viewcode-block" id="unpack_class"><a class="viewcode-back" href="../../javatools/#javatools.unpack_class">[docs]</a><span class="k">def</span> <span class="nf">unpack_class</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">magic</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    unpacks a Java class from data, which can be a string, a buffer,</span>
<span class="sd">    or a stream supporting the read method. Returns a populated</span>
<span class="sd">    JavaClassInfo instance.</span>

<span class="sd">    If data is a stream which has already been confirmed to be a java</span>
<span class="sd">    class, it may have had the first four bytes read from it already.</span>
<span class="sd">    In this case, pass those magic bytes as a str or tuple and the</span>
<span class="sd">    unpacker will not attempt to read them again.</span>

<span class="sd">    Raises a ClassUnpackException or an UnpackException if the class</span>
<span class="sd">    data is malformed. Raises Unimplemented if a feature is discovered</span>
<span class="sd">    which isn&#39;t understood by javatools yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">as</span> <span class="n">up</span><span class="p">:</span>
        <span class="n">magic</span> <span class="o">=</span> <span class="n">magic</span> <span class="ow">or</span> <span class="n">up</span><span class="o">.</span><span class="n">unpack_struct</span><span class="p">(</span><span class="n">_BBBB</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">magic</span> <span class="o">!=</span> <span class="n">JAVA_CLASS_MAGIC</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ClassUnpackException</span><span class="p">(</span><span class="s2">&quot;Not a Java class file&quot;</span><span class="p">)</span>

        <span class="n">o</span> <span class="o">=</span> <span class="n">JavaClassInfo</span><span class="p">()</span>
        <span class="n">o</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">up</span><span class="p">,</span> <span class="n">magic</span><span class="o">=</span><span class="n">magic</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">o</span></div>


<div class="viewcode-block" id="unpack_classfile"><a class="viewcode-back" href="../../javatools/#javatools.unpack_classfile">[docs]</a><span class="k">def</span> <span class="nf">unpack_classfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns a newly allocated JavaClassInfo object populated with the</span>
<span class="sd">    data unpacked from the specified file. Raises an UnpackException</span>
<span class="sd">    if the class data is malformed</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">,</span> <span class="n">_BUFFERING</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">unpack_class</span><span class="p">(</span><span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">())</span></div>


<span class="c1">#</span>
<span class="c1"># The end.</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">python-javatools 1.6.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">javatools</a></li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2014-2023, Christopher O&#39;Brien.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.1.3.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-47351906-2");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>